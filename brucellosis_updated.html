<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Brucellosis Codes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="brucellosis_updated_files/libs/clipboard/clipboard.min.js"></script>
<script src="brucellosis_updated_files/libs/quarto-html/quarto.js"></script>
<script src="brucellosis_updated_files/libs/quarto-html/popper.min.js"></script>
<script src="brucellosis_updated_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="brucellosis_updated_files/libs/quarto-html/anchor.min.js"></script>
<link href="brucellosis_updated_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="brucellosis_updated_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="brucellosis_updated_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="brucellosis_updated_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="brucellosis_updated_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link active" data-scroll-target="#data-processing">Data Processing</a></li>
  <li><a href="#mixed-effect-models" id="toc-mixed-effect-models" class="nav-link" data-scroll-target="#mixed-effect-models">Mixed Effect Models</a></li>
  <li><a href="#time-series-analysis" id="toc-time-series-analysis" class="nav-link" data-scroll-target="#time-series-analysis">Time Series Analysis</a>
  <ul class="collapse">
  <li><a href="#testing-for-several-aspects-of-the-time-series" id="toc-testing-for-several-aspects-of-the-time-series" class="nav-link" data-scroll-target="#testing-for-several-aspects-of-the-time-series">Testing for several aspects of the time series</a>
  <ul class="collapse">
  <li><a href="#correlation-of-human-incidence-with-its-past-values" id="toc-correlation-of-human-incidence-with-its-past-values" class="nav-link" data-scroll-target="#correlation-of-human-incidence-with-its-past-values">1. Correlation of human incidence with it’s past values</a></li>
  <li><a href="#decomposing-the-time-series" id="toc-decomposing-the-time-series" class="nav-link" data-scroll-target="#decomposing-the-time-series">3. Decomposing the time series</a></li>
  </ul></li>
  <li><a href="#train-and-testing-data" id="toc-train-and-testing-data" class="nav-link" data-scroll-target="#train-and-testing-data">Train and testing data</a></li>
  <li><a href="#training-the-models" id="toc-training-the-models" class="nav-link" data-scroll-target="#training-the-models">Training the Models</a>
  <ul class="collapse">
  <li><a href="#model-without-the-covariate" id="toc-model-without-the-covariate" class="nav-link" data-scroll-target="#model-without-the-covariate">1. Model without the covariate</a></li>
  <li><a href="#model-with-the-covariate" id="toc-model-with-the-covariate" class="nav-link" data-scroll-target="#model-with-the-covariate">2. Model with the covariate</a></li>
  <li><a href="#comparison-of-the-model-with-and-without-a-covariate" id="toc-comparison-of-the-model-with-and-without-a-covariate" class="nav-link" data-scroll-target="#comparison-of-the-model-with-and-without-a-covariate">3. Comparison of the Model with and Without a covariate</a></li>
  </ul></li>
  <li><a href="#full-model-for-forecasting-2023-data" id="toc-full-model-for-forecasting-2023-data" class="nav-link" data-scroll-target="#full-model-for-forecasting-2023-data">Full model for forecasting 2023 data</a></li>
  <li><a href="#supplementary-plots" id="toc-supplementary-plots" class="nav-link" data-scroll-target="#supplementary-plots">Supplementary Plots</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Brucellosis Codes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing">Data Processing</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'clean_all_data.R'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: pacman</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I18 / R18C9: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in L18 / R18C12: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I19 / R19C9: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in L19 / R19C12: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I85 / R85C9: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `year` -&gt; `year...10`
• `year` -&gt; `year...13`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 282 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): County, species
dbl (1): species_num

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
`summarise()` has grouped output by 'county', 'year', 'date', 'diseases', 'diagnosis'. You can override using the `.groups` argument.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifying the outliers in the number of cases</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">'cases'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">summary</span>(.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$hum_cases
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
    0.0    82.0   245.0   501.4   633.0  9623.0      26 

$catt_cases
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   1.000   1.000   3.584   3.000  70.000    9240 

$cam_cases
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  1.000   1.000   1.500   3.125   2.500  13.000    9369 

$goat_cases
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    1.00    4.00   21.24   13.00  528.00    9306 

$shp_cases
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    1.00    2.00    6.76    8.00   81.00    9352 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> .x)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> .y) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_light</span>()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$hum_cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 26 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$catt_cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9240 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$cam_cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9369 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$goat_cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9306 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$shp_cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9352 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replacing the outliers with the mean</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_incidence2 <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_cases =</span> <span class="fu">ifelse</span>(catt_cases <span class="sc">&gt;=</span> <span class="dv">69</span>, <span class="fu">round</span>(<span class="fu">mean</span>(catt_cases, <span class="at">na.rm =</span> T)), catt_cases),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_cases =</span> <span class="fu">ifelse</span>(goat_cases <span class="sc">&gt;</span> <span class="dv">28</span>, <span class="fu">round</span>(<span class="fu">mean</span>(goat_cases, <span class="at">na.rm =</span> T)), goat_cases)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>df_tot_cases <span class="ot">&lt;-</span> df_incidence2 <span class="sc">|&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, county) <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"cases"</span>), <span class="sc">~</span> <span class="fu">sum</span>(., <span class="at">na.rm =</span> T))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Population per year, per county</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_pop <span class="ot">&lt;-</span> df_incidence2 <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="st">"pop"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(.) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, county) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">unique</span>(.)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> df_tot_cases <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"county"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_incidence =</span> <span class="fu">round</span>((catt_cases <span class="sc">/</span> catt_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cam_incidence =</span> <span class="fu">round</span>((cam_cases <span class="sc">/</span> cam_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_incidence =</span> <span class="fu">round</span>((goat_cases <span class="sc">/</span> goat_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">shp_incidence =</span> <span class="fu">round</span>((shp_cases <span class="sc">/</span> sheep_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"incidence"</span>, <span class="st">"cases"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(county)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>df_1_pop <span class="ot">&lt;-</span> df_tot_cases <span class="sc">|&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"county"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, pop)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_1_pop, <span class="st">'county_humanpop.csv'</span>, <span class="at">row.names =</span> F)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>df_1_complete <span class="ot">&lt;-</span> df_1 <span class="sc">|&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    date,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    county,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    human_incidence,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    catt_incidence,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    goat_incidence,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    hum_cases,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    catt_cases,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    goat_cases</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(catt_incidence <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_1_complete, <span class="st">"df_1_complete.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Outliers</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="ot">&lt;-</span> df_1 <span class="sc">%&gt;%</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">'incidence'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric)</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="sc">%&gt;%</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">summary</span>(.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$human_incidence
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.2528  0.6593  1.0400  1.5011 12.3950 

$catt_incidence
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
  0.0000   0.0000   0.0000   0.1546   0.0000 234.7197 

$cam_incidence
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's 
  0.0000   0.0000   0.0000   0.0417   0.0000 121.9558     1911 

$goat_incidence
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
 0.00000  0.00000  0.00000  0.03123  0.00000 27.45740 

$shp_incidence
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
 0.00000  0.00000  0.00000  0.01431  0.00000 45.07380 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">y =</span> .x)) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> .y) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_light</span>()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$human_incidence</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$catt_incidence</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$cam_incidence</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1911 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$goat_incidence</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$shp_incidence</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Grouping%20the%20Data-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_cum <span class="ot">&lt;-</span> df_tot_cases <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"county"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_cases =</span> <span class="fu">sum</span>(catt_cases, goat_cases, shp_cases, cam_cases, <span class="at">na.rm =</span> T),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_pop =</span> <span class="fu">sum</span>(catt_pop, goat_pop, sheep_pop, cam_pop, <span class="at">na.rm =</span> T),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_cases =</span> <span class="fu">ifelse</span>(animal_cases <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, animal_cases),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_incidence =</span> <span class="fu">round</span>((animal_cases <span class="sc">/</span> animal_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"incidence"</span>, <span class="st">'cases'</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>()</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>df_cum_complete <span class="ot">&lt;-</span> df_cum <span class="sc">|&gt;</span> </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, human_incidence, animal_incidence, animal_cases, hum_cases) <span class="sc">|&gt;</span> </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(animal_incidence <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_cum_complete, <span class="st">"df_cum_complete.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="do">## County</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>df_county <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, <span class="fu">contains</span>(<span class="st">"cases"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_cases =</span> <span class="fu">ifelse</span>(catt_cases <span class="sc">&gt;=</span> <span class="dv">69</span>, <span class="fu">round</span>(<span class="fu">mean</span>(catt_cases, <span class="at">na.rm =</span> T)), catt_cases),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_cases =</span> <span class="fu">ifelse</span>(goat_cases <span class="sc">&gt;</span> <span class="dv">28</span>, <span class="fu">round</span>(<span class="fu">mean</span>(goat_cases, <span class="at">na.rm =</span> T)), goat_cases)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span> </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(<span class="fu">sum</span>(., <span class="at">na.rm =</span> T))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_incidence2_trend <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         county, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>         diseases, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         diagnosis, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">contains</span>(<span class="st">"cases"</span>), </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>         catt_pop, </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>         goat_pop, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>         sheep_pop, </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>         cam_pop) <span class="sc">|&gt;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(date))) <span class="sc">|&gt;</span> </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"county"</span>, <span class="st">"year"</span>)) </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>df_tot_cases_trend <span class="ot">&lt;-</span> df_incidence2_trend <span class="sc">|&gt;</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"cases"</span>), <span class="sc">~</span> <span class="fu">sum</span>(., <span class="at">na.rm =</span> T))) <span class="sc">|&gt;</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'cases'</span>), <span class="sc">~</span><span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, .)))</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>df_tot_pop_trend <span class="ot">&lt;-</span> df_incidence2_trend <span class="sc">|&gt;</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="st">"pop"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(.) <span class="sc">|&gt;</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheep_pop =</span> <span class="fu">sum</span>(sheep_pop),</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_pop =</span> <span class="fu">sum</span>(goat_pop),</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">cam_pop =</span> <span class="fu">sum</span>(cam_pop),</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_pop =</span> <span class="fu">sum</span>(catt_pop),</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">hum_pop =</span> <span class="fu">sum</span>(pop)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>df_1_trend <span class="ot">&lt;-</span> df_tot_cases_trend <span class="sc">|&gt;</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_tot_pop_trend, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> hum_pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>),</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_incidence =</span> <span class="fu">round</span>((catt_cases <span class="sc">/</span> catt_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">cam_incidence =</span> <span class="fu">round</span>((cam_cases <span class="sc">/</span> cam_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_incidence =</span> <span class="fu">round</span>((goat_cases <span class="sc">/</span> goat_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">shp_incidence =</span> <span class="fu">round</span>((shp_cases <span class="sc">/</span> sheep_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date)</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_1_trend, <span class="st">"individual_incidence.csv"</span>)</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>df_1_trend_complete <span class="ot">&lt;-</span> df_1_trend <span class="sc">|&gt;</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, human_incidence, catt_incidence, goat_incidence) <span class="sc">|&gt;</span> </span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(catt_incidence)) <span class="sc">|&gt;</span> </span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Cases</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>df_1_trend_cases <span class="ot">&lt;-</span> df_tot_cases_trend <span class="sc">|&gt;</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_tot_pop_trend, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> hum_pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>),</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_incidence =</span> <span class="fu">round</span>((catt_cases <span class="sc">/</span> catt_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">cam_incidence =</span> <span class="fu">round</span>((cam_cases <span class="sc">/</span> cam_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_incidence =</span> <span class="fu">round</span>((goat_cases <span class="sc">/</span> goat_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">shp_incidence =</span> <span class="fu">round</span>((shp_cases <span class="sc">/</span> sheep_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date)</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"incidence"</span>, <span class="st">"cases"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_1_trend_cases, <span class="st">"individual_incidence_cases.csv"</span>)</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a><span class="do">## The differenced one</span></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> df_1_trend<span class="sc">$</span>date[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>df_1_trend_diff <span class="ot">&lt;-</span> df_1_trend <span class="sc">|&gt;</span> </span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"incidence"</span>), <span class="sc">~</span> <span class="fu">diff</span>(., <span class="at">na.rm =</span> T))) <span class="sc">|&gt;</span> </span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a>df_cum_trend <span class="ot">&lt;-</span> df_tot_cases_trend <span class="sc">|&gt;</span></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_tot_pop_trend, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_cases =</span> <span class="fu">sum</span>(catt_cases, goat_cases, shp_cases, cam_cases, <span class="at">na.rm =</span> T),</span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_pop =</span> <span class="fu">sum</span>(catt_pop, goat_pop, sheep_pop, cam_pop, <span class="at">na.rm =</span> T),</span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># animal_cases = ifelse(animal_cases == 0, NA, animal_cases),</span></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> hum_pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>),</span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_incidence =</span> <span class="fu">round</span>((animal_cases <span class="sc">/</span> animal_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>)</span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="fu">contains</span>(<span class="st">"incidence"</span>))</span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_cum_trend, <span class="st">"combined_incidence.csv"</span>)</span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Cases</span></span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a>df_cum_trend_cases <span class="ot">&lt;-</span> df_tot_cases_trend <span class="sc">|&gt;</span></span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_tot_pop_trend, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_cases =</span> <span class="fu">sum</span>(catt_cases, goat_cases, shp_cases, cam_cases, <span class="at">na.rm =</span> T),</span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_pop =</span> <span class="fu">sum</span>(catt_pop, goat_pop, sheep_pop, cam_pop, <span class="at">na.rm =</span> T),</span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a>        <span class="co"># animal_cases = ifelse(animal_cases == 0, NA, animal_cases),</span></span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a>         <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> hum_pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>),</span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_incidence =</span> <span class="fu">round</span>((animal_cases <span class="sc">/</span> animal_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>)</span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"incidence"</span>, <span class="st">"cases"</span>)))</span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_cum_trend_cases, <span class="st">"combined_incidence_cases.csv"</span>)</span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a><span class="co"># The differenced one</span></span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a>df_cum_trend_diff <span class="ot">&lt;-</span> df_cum_trend <span class="sc">|&gt;</span> </span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span>  </span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="fu">across</span>(<span class="fu">c</span>(human_incidence, animal_incidence), <span class="sc">~</span> <span class="fu">diff</span>(., <span class="dv">1</span>, <span class="at">na.rm =</span> T))) <span class="sc">|&gt;</span> </span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a>trend_data <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">unique</span>(name)),</span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Human Incidence"</span>, <span class="st">"Cattle Incidence"</span>, <span class="st">"Goat Incidence"</span>,</span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Sheep Incidence"</span>, <span class="st">"Camel Incidence"</span></span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a>all_plus_hum <span class="ot">&lt;-</span> df_cum_trend <span class="sc">|&gt;</span> </span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(!is.na(animal_incidence)) |&gt; </span></span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_incidence =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(animal_incidence), <span class="dv">0</span>, animal_incidence)) <span class="sc">|&gt;</span> </span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date)) <span class="sc">+</span></span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> animal_incidence), <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> animal_incidence), <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Animal Incidence"</span>) <span class="sc">+</span></span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Animal Incidence'</span>)</span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true" tabindex="-1"></a>all_plus_hum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/plotting%20the%20trends%20over%20time-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All except humans</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>species_plt <span class="ot">&lt;-</span> trend_data <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">"Human Incidence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value), <span class="dv">0</span>, value)) <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">col =</span> name), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">col =</span> name), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#facet_wrap(~name, scales = "free", ncol = 3) +</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Incidence/1,000,000 population"</span>) <span class="sc">+</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Species"</span>, <span class="at">title =</span> <span class="st">"Incidence rate for cattle, goats, sheep and camels"</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>species_plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/plotting%20the%20trends%20over%20time-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Humans</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>humans_plt <span class="ot">&lt;-</span> trend_data <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Human Incidence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value), <span class="dv">0</span>, value)) <span class="sc">|&gt;</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> value), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#facet_wrap(~name, scales = "free", ncol = 3) +</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Incidence/1,000 population"</span>) <span class="sc">+</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Species"</span>, <span class="at">title =</span> <span class="st">"Incidence rate for humans"</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>humans_plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/plotting%20the%20trends%20over%20time-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># At county Level</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>adf1 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1<span class="sc">$</span>human_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(na.omit(df_1$human_incidence)): p-value smaller than
printed p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>adf2 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1<span class="sc">$</span>catt_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(na.omit(df_1$catt_incidence)): p-value smaller than printed
p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>adf3 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1<span class="sc">$</span>cam_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(na.omit(df_1$cam_incidence)): p-value smaller than printed
p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>adf4 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1<span class="sc">$</span>goat_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(na.omit(df_1$goat_incidence)): p-value smaller than printed
p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>adf5 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1<span class="sc">$</span>shp_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(na.omit(df_1$shp_incidence)): p-value smaller than printed
p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>adf_res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Human Incidence"</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cattle Incidence"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Camel Incidence"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Goat Incidence"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sheep Incidence"</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="fu">c</span>(</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    adf1<span class="sc">$</span>statistic,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    adf2<span class="sc">$</span>statistic,</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    adf3<span class="sc">$</span>statistic,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    adf4<span class="sc">$</span>statistic,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    adf5<span class="sc">$</span>statistic</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">P Value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    adf1<span class="sc">$</span>p.value,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    adf2<span class="sc">$</span>p.value,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    adf3<span class="sc">$</span>p.value,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    adf4<span class="sc">$</span>p.value,</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    adf5<span class="sc">$</span>p.value</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"l"</span>,</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Results of Augmented Dickey-Fuller Test for Stationarity at County Level"</span>,</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"pipe"</span>,</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">latex_options =</span> <span class="st">"hold_position"</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="co"># At National Level</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>adf_trend1 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1_trend<span class="sc">$</span>human_incidence))</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>adf_trend2 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1_trend<span class="sc">$</span>catt_incidence))</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>adf_trend3 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1_trend<span class="sc">$</span>cam_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(na.omit(df_1_trend$cam_incidence)): p-value smaller than
printed p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>adf_trend4 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1_trend<span class="sc">$</span>goat_incidence))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>adf_trend5 <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_1_trend<span class="sc">$</span>shp_incidence))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>adf_trend_res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">c</span>(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Human Incidence"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cattle Incidence"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Camel Incidence"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Goat Incidence"</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sheep Incidence"</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Statistic =</span> <span class="fu">c</span>(</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    adf_trend1<span class="sc">$</span>statistic,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    adf_trend2<span class="sc">$</span>statistic,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    adf_trend3<span class="sc">$</span>statistic,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    adf_trend4<span class="sc">$</span>statistic,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    adf_trend5<span class="sc">$</span>statistic</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">P Value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    adf_trend1<span class="sc">$</span>p.value,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    adf_trend2<span class="sc">$</span>p.value,</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    adf_trend3<span class="sc">$</span>p.value,</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    adf_trend4<span class="sc">$</span>p.value,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    adf_trend5<span class="sc">$</span>p.value</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"l"</span>,</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Results of Augmented Dickey-Fuller Test for Stationarity at National Level"</span>,</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"pipe"</span>,</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">latex_options =</span> <span class="st">"hold_position"</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="do">## All incidences combined</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>adf_combined <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(<span class="fu">na.omit</span>(df_cum<span class="sc">$</span>animal_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(na.omit(df_cum$animal_incidence)): p-value smaller than
printed p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>adf_combined_trend <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(df_cum_trend<span class="sc">$</span>animal_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(df_cum_trend$animal_incidence): p-value smaller than
printed p-value</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>adf_combined_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Level"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"County"</span>, <span class="st">"National"</span>),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Statistic"</span> <span class="ot">=</span> <span class="fu">c</span>(adf_combined<span class="sc">$</span>statistic, adf_combined_trend<span class="sc">$</span>statistic),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P Value"</span> <span class="ot">=</span> <span class="fu">c</span>(adf_combined<span class="sc">$</span>p.value, adf_combined_trend<span class="sc">$</span>p.value)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select columns containing "incidence"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>incidence_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"incidence"</span>, <span class="fu">names</span>(df_1_trend), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply moving average smoothing to selected columns</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>smoothed_df <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(incidence_cols, <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))) <span class="sc">|&gt;</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(incidence_cols), <span class="sc">~</span>zoo<span class="sc">::</span><span class="fu">rollmean</span>(., <span class="at">k =</span> <span class="dv">4</span>, <span class="at">fill =</span> <span class="cn">NA</span>), <span class="at">.names =</span> <span class="st">"smoothed_{.col}"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `across(incidence_cols, ~ifelse(is.na(.), 0, .))`.
Caused by warning:
! Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(incidence_cols)

  # Now:
  data %&gt;% select(all_of(incidence_cols))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows of the smoothed data</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(smoothed_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  date       human_incidence catt_incidence cam_incidence goat_incidence
  &lt;date&gt;               &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
1 2014-02-01           0.19               0             0              0
2 2014-03-01           0.218              0             0              0
3 2014-04-01           0.192              0             0              0
4 2014-05-01           0.205              0             0              0
5 2014-06-01           0.197              0             0              0
6 2014-07-01           0.225              0             0              0
# ℹ 6 more variables: shp_incidence &lt;dbl&gt;, smoothed_human_incidence &lt;dbl&gt;,
#   smoothed_catt_incidence &lt;dbl&gt;, smoothed_cam_incidence &lt;dbl&gt;,
#   smoothed_goat_incidence &lt;dbl&gt;, smoothed_shp_incidence &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>order <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smoothed_human_incidence"</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smoothed_catt_incidence"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smoothed_goat_incidence"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smoothed_shp_incidence"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smoothed_cam_incidence"</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>order2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Human Incidence"</span>, <span class="st">"Cattle Incidence"</span>, <span class="st">"Camel Incidence"</span>, <span class="st">"Goat Incidence"</span>, </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="st">"Sheep Incidence"</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>trend_data_smoothed <span class="ot">&lt;-</span> smoothed_df <span class="sc">%&gt;%</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="fu">contains</span>(<span class="st">"smoothed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> order),</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Human Incidence"</span>, <span class="st">"Cattle Incidence"</span>, <span class="st">"Goat Incidence"</span>,</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Sheep Incidence"</span>, <span class="st">"Camel Incidence"</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(incidence_cols, <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))) <span class="sc">|&gt;</span> </span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">case_when</span>(</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"human_incidence"</span> <span class="sc">~</span> <span class="st">"Human Incidence"</span>,</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"catt_incidence"</span> <span class="sc">~</span> <span class="st">"Cattle Incidence"</span>,</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span> <span class="st">"Goat Incidence"</span>,</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"shp_incidence"</span> <span class="sc">~</span> <span class="st">"Sheep Incidence"</span>,</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Camel Incidence"</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> order2),</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Human Incidence"</span>, <span class="st">"Cattle Incidence"</span>, <span class="st">"Goat Incidence"</span>,</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Sheep Incidence"</span>, <span class="st">"Camel Incidence"</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>species_sm_plt <span class="ot">&lt;-</span> trend_data_smoothed <span class="sc">|&gt;</span> </span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">"Human Incidence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">col =</span> name), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(aes(y = value, col = name)) +</span></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~name, scales = "free", ncol = 3) +</span></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Incidence/1,000,000 population"</span>) <span class="sc">+</span></span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Species"</span>, <span class="at">title =</span> <span class="st">"Smoothed Incidence rate for cattle, goats, sheep and camels"</span>)</span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a>species_sm_plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/moving%20average%20smoothing-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With points</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>species_sm_plt_points <span class="ot">&lt;-</span> trend_data_smoothed <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">"Human Incidence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">col =</span> name), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> trend_data <span class="sc">|&gt;</span> </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value), <span class="dv">0</span>, value)) <span class="sc">|&gt;</span> </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">"Human Incidence"</span>),</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">col =</span> name), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~name, scales = "free", ncol = 3) +</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Incidence/1,000,000 population"</span>) <span class="sc">+</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Species"</span>, <span class="at">title =</span> <span class="st">"Smoothed Incidence rate for cattle, goats, sheep and camels"</span>)</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>species_sm_plt_points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/moving%20average%20smoothing-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>humans_sm_plt <span class="ot">&lt;-</span> trend_data_smoothed <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Human Incidence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_1_trend, <span class="fu">aes</span>(<span class="at">y =</span> human_incidence), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~name, scales = "free", ncol = 3) +</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Incidence/1,000 population"</span>) <span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Species"</span>, <span class="at">title =</span> <span class="st">"Smoothed incidence rate for humans"</span>)</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>humans_sm_plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/moving%20average%20smoothing-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>humans_sm_plt_nopoints <span class="ot">&lt;-</span> trend_data_smoothed <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Human Incidence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(data = df_1_trend, aes(y = human_incidence), col = "red") +</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~name, scales = "free", ncol = 3) +</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Incidence/1,000 population"</span>) <span class="sc">+</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Species"</span>, <span class="at">title =</span> <span class="st">"Smoothed incidence rate for humans"</span>)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>humans_sm_plt_nopoints</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/moving%20average%20smoothing-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">## For all animal incidence combined</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>df_cum_trend <span class="ot">&lt;-</span> df_cum_trend <span class="sc">|&gt;</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>incidence_cols_cum <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"incidence"</span>, <span class="fu">names</span>(df_cum_trend), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply moving average smoothing to selected columns</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Select columns containing "incidence"</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>incidence_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"incidence"</span>, <span class="fu">names</span>(df_cum_trend), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply moving average smoothing to selected columns</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>smoothed_df_combined <span class="ot">&lt;-</span> df_cum_trend <span class="sc">%&gt;%</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_incidence =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(animal_incidence), <span class="dv">0</span>, animal_incidence)) <span class="sc">|&gt;</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all_of</span>(incidence_cols),</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> zoo<span class="sc">::</span><span class="fu">rollmean</span>(., <span class="at">k =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.names =</span> <span class="st">"smoothed_{.col}"</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>animal_sm_plt <span class="ot">&lt;-</span> smoothed_df_combined <span class="sc">|&gt;</span> </span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> smoothed_animal_incidence), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_cum_trend <span class="sc">|&gt;</span> </span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">animal_incidence =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(animal_incidence), <span class="dv">0</span>, animal_incidence)) </span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>               , <span class="fu">aes</span>(<span class="at">y =</span> animal_incidence), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~name, scales = "free", ncol = 3) +</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Incidence/1,000,000 population"</span>) <span class="sc">+</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"Species"</span>, <span class="at">title =</span> <span class="st">"Smoothed incidence rate for animal incidence combined"</span>)</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>animal_sm_plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/moving%20average%20smoothing-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>table1<span class="fl">.1</span> <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, diagnosis, <span class="fu">contains</span>(<span class="st">"cases"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_cases =</span> <span class="fu">ifelse</span>(catt_cases <span class="sc">&gt;=</span> <span class="dv">69</span>, <span class="fu">round</span>(<span class="fu">mean</span>(catt_cases, <span class="at">na.rm =</span> T)), catt_cases),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_cases =</span> <span class="fu">ifelse</span>(goat_cases <span class="sc">&gt;</span> <span class="dv">28</span>, <span class="fu">round</span>(<span class="fu">mean</span>(goat_cases, <span class="at">na.rm =</span> T)), goat_cases)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(county, diagnosis)) <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, <span class="at">Diagnosis =</span> diagnosis) <span class="sc">|&gt;</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Cases =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">|&gt;</span> </span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">recode</span>(</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>      name,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cam_cases"</span> <span class="ot">=</span> <span class="st">'Camels'</span>,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"hum_cases"</span> <span class="ot">=</span> <span class="st">'Humans'</span>,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"goat_cases"</span> <span class="ot">=</span> <span class="st">'Goats'</span>,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shp_cases"</span> <span class="ot">=</span> <span class="st">"Sheep"</span>,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"catt_cases"</span> <span class="ot">=</span> <span class="st">"Cattle"</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">|&gt;</span> </span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species, Diagnosis) <span class="sc">|&gt;</span> </span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">|&gt;</span> </span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Percent(%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>((Cases<span class="sc">/</span><span class="fu">sum</span>(Cases, <span class="at">na.rm =</span> T)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cases =</span> <span class="fu">format</span>(<span class="fu">round</span>(Cases), <span class="at">big.mark =</span> <span class="st">','</span>) <span class="sc">|&gt;</span> <span class="fu">str_squish</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">3</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"l"</span>, </span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="st">"Number of cases according to the type of Diagnosis"</span>, </span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">format =</span> <span class="st">"pipe"</span>,</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">latex_options =</span> <span class="st">"hold_position"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'name'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>table1<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Number of cases according to the type of Diagnosis</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Species</th>
<th style="text-align: left;">Diagnosis</th>
<th style="text-align: left;">Cases</th>
<th style="text-align: left;">Percent(%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Camels</td>
<td style="text-align: left;">Clinically confirmed</td>
<td style="text-align: left;">23</td>
<td style="text-align: left;">92.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Camels</td>
<td style="text-align: left;">Lab confirmed</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">8.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Camels</td>
<td style="text-align: left;">Post Mortem</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cattle</td>
<td style="text-align: left;">Clinically confirmed</td>
<td style="text-align: left;">225</td>
<td style="text-align: left;">62.50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cattle</td>
<td style="text-align: left;">Lab confirmed</td>
<td style="text-align: left;">121</td>
<td style="text-align: left;">33.61</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cattle</td>
<td style="text-align: left;">Post Mortem</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">3.89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Goats</td>
<td style="text-align: left;">Clinically confirmed</td>
<td style="text-align: left;">451</td>
<td style="text-align: left;">78.57</td>
</tr>
<tr class="even">
<td style="text-align: left;">Goats</td>
<td style="text-align: left;">Lab confirmed</td>
<td style="text-align: left;">123</td>
<td style="text-align: left;">21.43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Goats</td>
<td style="text-align: left;">Post Mortem</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Humans</td>
<td style="text-align: left;">Clinically confirmed</td>
<td style="text-align: left;">1,058,294</td>
<td style="text-align: left;">22.57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Humans</td>
<td style="text-align: left;">Lab confirmed</td>
<td style="text-align: left;">3,630,512</td>
<td style="text-align: left;">77.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">Humans</td>
<td style="text-align: left;">Post Mortem</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sheep</td>
<td style="text-align: left;">Clinically confirmed</td>
<td style="text-align: left;">152</td>
<td style="text-align: left;">89.94</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sheep</td>
<td style="text-align: left;">Lab confirmed</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">10.06</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sheep</td>
<td style="text-align: left;">Post Mortem</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>( df_incidence <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, diagnosis, <span class="fu">contains</span>(<span class="st">"cases"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(county, diagnosis)) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, <span class="at">Diagnosis =</span> diagnosis) <span class="sc">|&gt;</span> </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Cases =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">|&gt;</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">recode</span>(</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>      name,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cam_cases"</span> <span class="ot">=</span> <span class="st">'Camels'</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"hum_cases"</span> <span class="ot">=</span> <span class="st">'Humans'</span>,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"goat_cases"</span> <span class="ot">=</span> <span class="st">'Goats'</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shp_cases"</span> <span class="ot">=</span> <span class="st">"Sheep"</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"catt_cases"</span> <span class="ot">=</span> <span class="st">"Cattle"</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">|&gt;</span> </span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species, Diagnosis) <span class="sc">|&gt;</span> </span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">|&gt;</span> </span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Percent(%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>((Cases<span class="sc">/</span><span class="fu">sum</span>(Cases)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">3</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>),</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cases_table.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'name'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The descriptive statistics are for the Incidence Rate National Wide</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> df_1 <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">minimum =</span> <span class="fu">min</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">case_when</span>(</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>     name <span class="sc">==</span>  <span class="st">"human_incidence"</span> <span class="sc">~</span>   <span class="st">"Human"</span>,</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span><span class="st">"catt_incidence"</span>  <span class="sc">~</span>  <span class="st">"Cattle"</span>, </span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span>  <span class="st">"Goat"</span>, </span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">"cam_incidence"</span>  <span class="sc">~</span> <span class="st">"Camel"</span>, </span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">"shp_incidence"</span> <span class="sc">~</span>  <span class="st">"Sheep"</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>     ),</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cases =</span> <span class="fu">comma</span>(<span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span>),</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Minimum =</span> <span class="fu">comma</span>(minimum),</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median =</span> <span class="fu">comma</span>(median),</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Maximum =</span> <span class="fu">comma</span>(max),</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Standard Deviation</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">comma</span>(sd)</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Species =</span> name,</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span>,</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>         Minimum,</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>         Median,</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>         Maximum,</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Standard Deviation</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"l"</span>,</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Descriptive Statistics for Incidence Rate"</span>,</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"pipe"</span>,</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">latex_options =</span> <span class="st">"hold_position"</span></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Descriptive Statistics for Incidence Rate</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 28%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Species</th>
<th style="text-align: left;">Mean Incidence Rate</th>
<th style="text-align: left;">Minimum</th>
<th style="text-align: left;">Median</th>
<th style="text-align: left;">Maximum</th>
<th style="text-align: left;">Standard Deviation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Human</td>
<td style="text-align: left;">1.0400485</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.66</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">1.114</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cattle</td>
<td style="text-align: left;">0.1546213</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">235</td>
<td style="text-align: left;">3.710</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Camel</td>
<td style="text-align: left;">0.0416705</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">122</td>
<td style="text-align: left;">2.191</td>
</tr>
<tr class="even">
<td style="text-align: left;">Goat</td>
<td style="text-align: left;">0.0312345</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">27</td>
<td style="text-align: left;">0.630</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sheep</td>
<td style="text-align: left;">0.0143072</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">45</td>
<td style="text-align: left;">0.653</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_1 <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">minimum =</span> <span class="fu">min</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">case_when</span>(</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>     name <span class="sc">==</span>  <span class="st">"human_incidence"</span> <span class="sc">~</span>   <span class="st">"Human"</span>,</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span><span class="st">"catt_incidence"</span>  <span class="sc">~</span>  <span class="st">"Cattle"</span>, </span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span>  <span class="st">"Goat"</span>, </span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">"cam_incidence"</span>  <span class="sc">~</span> <span class="st">"Camel"</span>, </span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">"shp_incidence"</span> <span class="sc">~</span>  <span class="st">"Sheep"</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>     ),</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cases =</span> <span class="fu">comma</span>(<span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span>),</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Minimum =</span> <span class="fu">comma</span>(minimum),</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median =</span> <span class="fu">comma</span>(median),</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Maximum =</span> <span class="fu">comma</span>(max),</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Standard Deviation</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">comma</span>(sd)</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Species =</span> name,</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Mean Incidence Rate</span><span class="st">`</span>,</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>         Minimum,</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>         Median,</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>         Maximum,</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Standard Deviation</span><span class="st">`</span>),</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"descriptive_table.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cases per year per county</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>df_tot_cases_spatial <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(date)), county) <span class="sc">|&gt;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"cases"</span>), <span class="sc">~</span> <span class="fu">sum</span>(., <span class="at">na.rm =</span> T))) <span class="sc">|&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'cases'</span>), <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, .)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Population per year, per county</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>df_pop_spatial <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="st">"pop"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(.) <span class="sc">|&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(date)), county) <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">unique</span>(.))) <span class="sc">|&gt;</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'cases'</span>), <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, .)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual Cases per year per county month</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>df_tot_cases_spatial_month <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, county) <span class="sc">|&gt;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"cases"</span>), <span class="sc">~</span> <span class="fu">sum</span>(., <span class="at">na.rm =</span> T))) <span class="sc">|&gt;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(date))) <span class="sc">|&gt;</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_pop_spatial, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"county"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) <span class="sc">|&gt;</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>),</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_incidence =</span> <span class="fu">round</span>((catt_cases <span class="sc">/</span> catt_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cam_incidence =</span> <span class="fu">round</span>((cam_cases <span class="sc">/</span> cam_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_incidence =</span> <span class="fu">round</span>((goat_cases <span class="sc">/</span> goat_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">shp_incidence =</span> <span class="fu">round</span>((shp_cases <span class="sc">/</span> sheep_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, date, county, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"incidence"</span>, <span class="st">"cases"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_tot_cases_spatial_month,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">"df_tot_cases_spatial_month.csv"</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>df_tot_cases_spatial_month_complete <span class="ot">&lt;-</span> df_tot_cases_spatial_month <span class="sc">|&gt;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    date,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    county,</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    human_incidence,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    goat_incidence,</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    catt_incidence,</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    goat_cases,</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    catt_cases,</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    hum_cases</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_tot_cases_spatial_month_complete,</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">"df_tot_cases_spatial_month_complete.csv"</span>)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined cases</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>df_spatial_cum_month <span class="ot">&lt;-</span> df_tot_cases_spatial_month <span class="sc">|&gt;</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_pop_spatial, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"county"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_cases =</span> <span class="fu">sum</span>(catt_cases, goat_cases, shp_cases, cam_cases, <span class="at">na.rm =</span> T),</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_pop =</span> <span class="fu">sum</span>(catt_pop, goat_pop, sheep_pop, cam_pop, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, .),</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_incidence =</span> <span class="fu">round</span>((animal_cases <span class="sc">/</span> animal_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>)</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, year, county, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"incidence"</span>, <span class="st">"cases"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_spatial_cum_month, <span class="st">"df_spatial_cum_month.csv"</span>)</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Population per year, per county</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>df_pop_spatial <span class="ot">&lt;-</span> df_incidence2<span class="fl">.1</span> <span class="sc">|&gt;</span></span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="st">"pop"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(.) <span class="sc">|&gt;</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">year =</span> <span class="fu">year</span>(date), county) <span class="sc">%&gt;%</span></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">unique</span>(.))) <span class="sc">|&gt;</span></span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'cases'</span>), <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, .)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df_spatial <span class="ot">&lt;-</span> df_tot_cases_spatial <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_pop_spatial, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"county"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) <span class="sc">|&gt;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">catt_incidence =</span> <span class="fu">round</span>((catt_cases <span class="sc">/</span> catt_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cam_incidence =</span> <span class="fu">round</span>((cam_cases <span class="sc">/</span> cam_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">goat_incidence =</span> <span class="fu">round</span>((goat_cases <span class="sc">/</span> goat_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">shp_incidence =</span> <span class="fu">round</span>((shp_cases <span class="sc">/</span> sheep_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, county, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(across(is.numeric, ~ifelse(is.na(.), 0, .))) |&gt;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>df_spatial_cum <span class="ot">&lt;-</span> df_tot_cases_spatial <span class="sc">|&gt;</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(df_pop_spatial, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"county"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_cases =</span> <span class="fu">sum</span>(catt_cases, goat_cases, shp_cases, cam_cases, <span class="at">na.rm =</span> T),</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_pop =</span> <span class="fu">sum</span>(catt_pop, goat_pop, sheep_pop, cam_pop, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, .),</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_cases =</span> <span class="fu">ifelse</span>(animal_cases <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, animal_cases),</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">animal_incidence =</span> <span class="fu">round</span>((animal_cases <span class="sc">/</span> animal_pop) <span class="sc">*</span> <span class="dv">1000000</span>, <span class="dv">4</span>),</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">human_incidence =</span> <span class="fu">round</span>((hum_cases <span class="sc">/</span> pop) <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">4</span>)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, county, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking for mismatch of county names in the shapefiles and in our data</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(shp<span class="sc">$</span>Name, df_spatial<span class="sc">$</span>county)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Muranga"</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(df_spatial<span class="sc">$</span>county, shp<span class="sc">$</span>Name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Murang'a"</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replacing Muranga to Murang'a</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>shp <span class="ot">&lt;-</span> shp <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Name =</span> <span class="fu">ifelse</span>(Name <span class="sc">==</span> <span class="st">"Muranga"</span>, <span class="st">"Murang'a"</span>, Name))</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(shp<span class="sc">$</span>Name, df_spatial<span class="sc">$</span>county)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(df_spatial<span class="sc">$</span>county, shp<span class="sc">$</span>Name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(df_spatial<span class="sc">$</span>county))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>df_spatial_merged <span class="ot">&lt;-</span> df_spatial <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(shp, <span class="at">by.x =</span> <span class="st">"county"</span>, <span class="at">by.y =</span> <span class="st">'Name'</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>indi_incidence_columns <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"incidence"</span>, <span class="fu">names</span>(df_spatial_merged), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>df_spatial_merged <span class="ot">&lt;-</span> df_spatial_merged <span class="sc">|&gt;</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all_of</span>(indi_incidence_columns),</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">cut</span>(</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>      .,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">quantile</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.names =</span> <span class="st">"{col}_range"</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>df_spatial_merged_cum <span class="ot">&lt;-</span> df_spatial_cum <span class="sc">|&gt;</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(shp, <span class="at">by.x =</span> <span class="st">"county"</span>, <span class="at">by.y =</span> <span class="st">'Name'</span>)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>all_incidence_columns <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"incidence"</span>, <span class="fu">names</span>(df_spatial_merged_cum), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>df_spatial_merged_cum <span class="ot">&lt;-</span> df_spatial_merged_cum <span class="sc">|&gt;</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all_of</span>(all_incidence_columns),</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">cut</span>(</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>      .,</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">quantile</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">.names =</span> <span class="st">"{col}_range"</span></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert year to factor for better plotting</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>df_spatial_merged<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_spatial_merged<span class="sc">$</span>year)</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>df_spatial_merged_cum<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_spatial_merged_cum<span class="sc">$</span>year)</span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a><span class="co"># All animals incidence</span></span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a>cate_animal <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(df_spatial_merged_cum<span class="sc">$</span>animal_incidence_range))</span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a>animals <span class="ot">&lt;-</span> df_spatial_merged_cum <span class="sc">|&gt;</span></span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_incidence_range =</span> <span class="fu">ifelse</span>(</span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(animal_incidence_range),</span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"0"</span>,</span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(animal_incidence_range)</span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a>      .,</span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0"</span>,</span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'[0.113,0.894]'</span>,</span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">'(0.894,2.16]'</span>,</span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">'(2.16,6]'</span>,</span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">'(6,336]'</span></span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span></span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> animal_incidence_range)) <span class="sc">+</span></span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="fu">brewer.pal</span>(cate_animal, <span class="st">"YlOrRd"</span>)),</span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="cf">function</span>(breaks) {</span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace_all</span>(breaks, <span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">("</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace_all</span>(., <span class="st">","</span>, <span class="st">" - "</span>)</span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"white"</span></span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb91-67"><a href="#cb91-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb91-68"><a href="#cb91-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> year, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb91-69"><a href="#cb91-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb91-70"><a href="#cb91-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb91-71"><a href="#cb91-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb91-72"><a href="#cb91-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb91-73"><a href="#cb91-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">16</span></span>
<span id="cb91-74"><a href="#cb91-74" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb91-75"><a href="#cb91-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb91-76"><a href="#cb91-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb91-77"><a href="#cb91-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb91-78"><a href="#cb91-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>, <span class="st">"cm"</span>),</span>
<span id="cb91-79"><a href="#cb91-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb91-80"><a href="#cb91-80" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb91-81"><a href="#cb91-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Animals"</span>) <span class="sc">+</span></span>
<span id="cb91-82"><a href="#cb91-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Animals"</span>)</span>
<span id="cb91-83"><a href="#cb91-83" aria-hidden="true" tabindex="-1"></a>animals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/The%20spatial%20analysis/plotting-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Humans</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>cate_human <span class="ot">&lt;-</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">levels</span>(df_spatial_merged_cum<span class="sc">$</span>human_incidence_range))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>humans <span class="ot">&lt;-</span>  </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(human_incidence_range = ifelse(is.na(human_incidence_range),</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                        "0",</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                        as.character(human_incidence_range)) %&gt;%</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#          factor(., levels = c(</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            "0",</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            "[0.113,0.865]",</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            "(0.865,1.85]",</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            "(1.85,5.62]",</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            "(5.62,67.4]"</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#          ))) |&gt;</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_sf(data = shp, fill = 'white') +</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> df_spatial_merged_cum, <span class="fu">aes</span>(<span class="at">fill =</span> human_incidence_range)) <span class="sc">+</span>  </span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="fu">brewer.pal</span>(cate_human, <span class="st">"YlOrRd"</span>)),</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(breaks) {</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(breaks, <span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">("</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace_all</span>(., <span class="st">","</span>, <span class="st">" - "</span>)</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"white"</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> year, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">16</span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>, <span class="st">"cm"</span>),</span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Humans"</span>) <span class="sc">+</span></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Humans"</span>)</span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>humans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/The%20spatial%20analysis/plotting-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>animals_humans <span class="ot">&lt;-</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_plots</span>(humans,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>             animals,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">guides =</span> <span class="st">"keep"</span>) <span class="sc">+</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">caption =</span> <span class="st">"For humans, the incidence rate is per</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="st">                  1,000 population while for animal,</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="st">                  the incidence rate is per 1,000,000 population</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="st">                  "</span>) <span class="sc">&amp;</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>animals_humans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/The%20spatial%20analysis/plotting-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>cate_catt <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(df_spatial_merged<span class="sc">$</span>catt_incidence_range))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>cattle <span class="ot">&lt;-</span> df_spatial_merged <span class="sc">|&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">catt_incidence_range =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(catt_incidence_range), </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"0"</span>, </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">as.character</span>(catt_incidence_range)) <span class="sc">%&gt;%</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(., <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"0"</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"[0.704,2.4]"</span>,</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"(2.4,5.45]"</span>, </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"(5.45,11.9]"</span>,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"(11.9,235]"</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>           ))) <span class="sc">|&gt;</span> </span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> catt_incidence_range)) <span class="sc">+</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="fu">brewer.pal</span>(cate_catt, <span class="st">"YlOrRd"</span>)),</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(breaks) {</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(breaks, <span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">("</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace_all</span>(., <span class="st">","</span>, <span class="st">" - "</span>)</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> year, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">16</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>, <span class="st">"cm"</span>),</span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Cattle"</span>) <span class="sc">+</span></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Cattle"</span>) </span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>cattle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/The%20spatial%20analysis/plotting-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Goats</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>cate_goat <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(df_spatial_merged<span class="sc">$</span>goat_incidence_range))</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>goat <span class="ot">&lt;-</span> df_spatial_merged <span class="sc">|&gt;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">goat_incidence_range =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(goat_incidence_range), </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"0"</span>, </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">as.character</span>(goat_incidence_range)) <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(., <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"0"</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"[0.13,0.8]"</span>,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(0.8,3.21]"</span>,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(3.21,9.34]"</span>,</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(9.34,690]"</span> </span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>           ))) <span class="sc">|&gt;</span> </span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> goat_incidence_range)) <span class="sc">+</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="fu">brewer.pal</span>(cate_goat, <span class="st">"YlOrRd"</span>)),</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(breaks) {</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(breaks, <span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">("</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace_all</span>(., <span class="st">","</span>, <span class="st">" - "</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> year, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">16</span></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>, <span class="st">"cm"</span>),</span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Goats"</span>) <span class="sc">+</span></span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Goat"</span>) </span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>goat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/The%20spatial%20analysis/plotting-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sheep</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>cate_shp <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(df_spatial_merged<span class="sc">$</span>shp_incidence_range))</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>sheep <span class="ot">&lt;-</span> df_spatial_merged <span class="sc">|&gt;</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">shp_incidence_range =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(shp_incidence_range), </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"0"</span>, </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">as.character</span>(shp_incidence_range)) <span class="sc">%&gt;%</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(., <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"0"</span>,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"[0.182,0.701]"</span>,</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(0.701,2.48]"</span>,</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(2.48,4.65]"</span>,</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(4.65,45.1]"</span>  </span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>           ))) <span class="sc">|&gt;</span> </span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> shp_incidence_range)) <span class="sc">+</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="fu">brewer.pal</span>(cate_shp, <span class="st">"YlOrRd"</span>)),</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(breaks) {</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(breaks, <span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">("</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace_all</span>(., <span class="st">","</span>, <span class="st">" - "</span>)</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> year, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">16</span></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>, <span class="st">"cm"</span>),</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sheep"</span>) <span class="sc">+</span></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Sheep"</span>) </span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>sheep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/The%20spatial%20analysis/plotting-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Camels</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>cate_cam <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(df_spatial_merged<span class="sc">$</span>cam_incidence_range))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>camels <span class="ot">&lt;-</span> df_spatial_merged <span class="sc">|&gt;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cam_incidence_range =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(cam_incidence_range), </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"0"</span>, </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">as.character</span>(cam_incidence_range)) <span class="sc">%&gt;%</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(., <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"0"</span>,</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"[0.613,1.9]"</span>,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(1.9,2.84]"</span>,</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(2.84,33]"</span>,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(33,122]"</span> </span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>           ))) <span class="sc">|&gt;</span> </span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> cam_incidence_range)) <span class="sc">+</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="fu">brewer.pal</span>(cate_cam, <span class="st">"YlOrRd"</span>)),</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(breaks) {</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(breaks, <span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">("</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace_all</span>(., <span class="st">","</span>, <span class="st">" - "</span>)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> year, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">16</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.7</span>, <span class="st">"cm"</span>),</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Camels"</span>) <span class="sc">+</span></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Camels"</span>) </span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>camels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/The%20spatial%20analysis/plotting-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>all_plots <span class="ot">&lt;-</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_plots</span>(humans,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>             cattle,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>             goat,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>             sheep,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>             camels,</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">guides =</span> <span class="st">"keep"</span>) <span class="sc">&amp;</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>null device 
          1 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"all_plots.png"</span>, <span class="at">dpi =</span> <span class="fl">1e3</span>, <span class="at">height =</span> <span class="dv">18</span>, <span class="at">width =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>all_plots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/spatial%20plot-1.png" class="img-fluid figure-img" width="1920"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Plot</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>df_1_trend <span class="ot">&lt;-</span> df_1_trend <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>cor_lag <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Human"</span>,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cattle"</span>,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Camel"</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Goat"</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Sheep"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between human incidence </span><span class="sc">\n</span><span class="st">and animal incidences"</span>,</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">35</span></span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span></span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>cor_lag</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Correlation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Plot at lag 1</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>cor_lag1 <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Human"</span>,</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cattle"</span>,</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Camel"</span>,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Goat"</span>,</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Sheep"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between</span><span class="sc">\n</span><span class="st">human incidence </span><span class="sc">\n</span><span class="st">and animal incidences at lag 1"</span>,</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb103-36"><a href="#cb103-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb103-37"><a href="#cb103-37" aria-hidden="true" tabindex="-1"></a>cor_lag1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Correlation-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Plot at lag 2</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>cor_lag2 <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">2</span>))) <span class="sc">|&gt;</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Human"</span>,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cattle"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Camel"</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Goat"</span>,</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Sheep"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between</span><span class="sc">\n</span><span class="st">human incidence </span><span class="sc">\n</span><span class="st">and animal incidences at lag 2"</span>,</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>cor_lag2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Correlation-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Plot at lag 3</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>cor_lag3 <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Human"</span>,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cattle"</span>,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Camel"</span>,</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Goat"</span>,</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Sheep"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between</span><span class="sc">\n</span><span class="st">human incidence </span><span class="sc">\n</span><span class="st">and animal incidences at lag 3"</span>,</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>cor_lag3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Correlation-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Plot at lag 4</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>cor_lag4 <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">4</span>))) <span class="sc">|&gt;</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Human"</span>,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cattle"</span>,</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Camel"</span>,</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Goat"</span>,</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Sheep"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between</span><span class="sc">\n</span><span class="st">human incidence </span><span class="sc">\n</span><span class="st">and animal incidences at lag 4"</span>,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>cor_lag4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Correlation-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Plot at lag 5</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>cor_lag5 <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">5</span>))) <span class="sc">|&gt;</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Human"</span>,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cattle"</span>,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Camel"</span>,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Goat"</span>,</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Sheep"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between</span><span class="sc">\n</span><span class="st">human incidence </span><span class="sc">\n</span><span class="st">and animal incidences at lag 5"</span>,</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb107-36"><a href="#cb107-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a>cor_lag5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Correlation-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Plot at lag 6</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>cor_lag6 <span class="ot">&lt;-</span> df_1_trend <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">6</span>))) <span class="sc">|&gt;</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">%&gt;%</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Human"</span>,</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cattle"</span>,</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Camel"</span>,</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Goat"</span>,</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Sheep"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  ggcorrplot<span class="sc">::</span><span class="fu">ggcorrplot</span>(<span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab =</span> <span class="cn">TRUE</span>,</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lab_size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between</span><span class="sc">\n</span><span class="st">human incidence </span><span class="sc">\n</span><span class="st">and animal incidences at lag 6"</span>,</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>cor_lag6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/Correlation-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>all_cols <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  cor_lag,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  cor_lag1,</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  cor_lag2,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  cor_lag3,</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  cor_lag4,</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  cor_lag5,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  cor_lag6,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">guides =</span> <span class="st">"collect"</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">7</span>,<span class="dv">7</span>)</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>all_cols <span class="ot">&lt;-</span> all_cols <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>, <span class="at">size =</span> <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>lag_values <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>  <span class="co"># Assuming you want lag values from 0 to 6</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>cor_dats <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    cor_lag<span class="sc">$</span>data,</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    cor_lag1<span class="sc">$</span>data,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    cor_lag2<span class="sc">$</span>data,</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    cor_lag3<span class="sc">$</span>data,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    cor_lag4<span class="sc">$</span>data,</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    cor_lag5<span class="sc">$</span>data,</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    cor_lag6<span class="sc">$</span>data</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>result_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lag =</span> lag_values,</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Average Correlation</span><span class="st">`</span> <span class="ot">=</span> cor_dats <span class="sc">%&gt;%</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">filter</span>(.x, Var1 <span class="sc">==</span> <span class="st">"Human"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dbl</span>(<span class="sc">~</span><span class="fu">mean</span>(.<span class="sc">$</span>value))</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Average Correlation</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"l"</span>, </span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="st">"Average correlation between human incidence and other species incidence, ordered from the largest to the smallest"</span>, </span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">format =</span> <span class="st">"pipe"</span>,</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">latex_options =</span> <span class="st">"hold_position"</span>)</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

Table: Average correlation between human incidence and other species incidence, ordered from the largest to the smallest

|Lag |Average Correlation |
|:---|:-------------------|
|0   |0.1475              |
|3   |0.1450              |
|2   |0.1225              |
|4   |0.1175              |
|1   |0.1150              |
|6   |0.1075              |
|5   |0.0650              |</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># This helps us to choose the lag with the highest average correlation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="do">## This model fits the data without differencing, at difference lags, (0-3) and for individual </span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="do">## animal incidences.</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>df_1_trend <span class="ot">&lt;-</span> df_1_trend <span class="sc">|&gt;</span> </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Models with NA</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>run_lag_models <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">max_lag =</span> <span class="dv">3</span>, ...) {</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  result_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (lag_value <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_lag) {</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    df_lagged <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> lag_value))) <span class="sc">|&gt;</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> df_lagged <span class="sc">|&gt;</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">TSLM</span>(</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>          (human_incidence) <span class="sc">~</span> cam_incidence <span class="sc">+</span> shp_incidence <span class="sc">+</span> catt_incidence <span class="sc">+</span> goat_incidence</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">report</span>()</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    mod_results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">%&gt;%</span></span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span> <span class="st">"Goat Incidence"</span>,</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"catt_incidence"</span> <span class="sc">~</span> <span class="st">"Cattle incidence"</span>,</span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"shp_incidence"</span> <span class="sc">~</span> <span class="st">"Sheep incidence"</span>,</span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"cam_incidence"</span> <span class="sc">~</span> <span class="st">"Camel incidence"</span>,</span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term) </span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> term</span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span>  <span class="fu">select</span>(<span class="dv">6</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_low =</span> <span class="fu">min</span>(estimate <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_high =</span> <span class="fu">max</span>(estimate <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">lag =</span> lag_value)</span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>    adj_r_squared <span class="ot">&lt;-</span> <span class="fu">glance</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(r_squared, AIC, adj_r_squared)</span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>    mod_results <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_results, adj_r_squared) <span class="sc">|&gt;</span></span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(estimate, std.error, statistic, p.value, conf_low, conf_high, adj_r_squared), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">significance =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>))</span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>    result_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_df, mod_results)</span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb113-59"><a href="#cb113-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result_df)</span>
<span id="cb113-60"><a href="#cb113-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-61"><a href="#cb113-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-62"><a href="#cb113-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Models with complete cases</span></span>
<span id="cb113-63"><a href="#cb113-63" aria-hidden="true" tabindex="-1"></a>complete_run_lag_models <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">max_lag =</span> <span class="dv">3</span>, ...) {</span>
<span id="cb113-64"><a href="#cb113-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb113-65"><a href="#cb113-65" aria-hidden="true" tabindex="-1"></a>  result_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb113-66"><a href="#cb113-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-67"><a href="#cb113-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (lag_value <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_lag) {</span>
<span id="cb113-68"><a href="#cb113-68" aria-hidden="true" tabindex="-1"></a>    df_lagged <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb113-69"><a href="#cb113-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb113-70"><a href="#cb113-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, goat_incidence),</span>
<span id="cb113-71"><a href="#cb113-71" aria-hidden="true" tabindex="-1"></a>                <span class="fu">list</span>( <span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> lag_value))) <span class="sc">|&gt;</span></span>
<span id="cb113-72"><a href="#cb113-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-73"><a href="#cb113-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb113-74"><a href="#cb113-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-75"><a href="#cb113-75" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> df_lagged <span class="sc">|&gt;</span></span>
<span id="cb113-76"><a href="#cb113-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb113-77"><a href="#cb113-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb113-78"><a href="#cb113-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">TSLM</span>(</span>
<span id="cb113-79"><a href="#cb113-79" aria-hidden="true" tabindex="-1"></a>          human_incidence <span class="sc">~</span> catt_incidence <span class="sc">+</span> goat_incidence</span>
<span id="cb113-80"><a href="#cb113-80" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb113-81"><a href="#cb113-81" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb113-82"><a href="#cb113-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">report</span>()</span>
<span id="cb113-83"><a href="#cb113-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-84"><a href="#cb113-84" aria-hidden="true" tabindex="-1"></a>    mod_results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb113-85"><a href="#cb113-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">%&gt;%</span></span>
<span id="cb113-86"><a href="#cb113-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb113-87"><a href="#cb113-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb113-88"><a href="#cb113-88" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span> <span class="st">"Goat Incidence"</span>,</span>
<span id="cb113-89"><a href="#cb113-89" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"catt_incidence"</span> <span class="sc">~</span> <span class="st">"Cattle incidence"</span>,</span>
<span id="cb113-90"><a href="#cb113-90" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term) </span>
<span id="cb113-91"><a href="#cb113-91" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb113-92"><a href="#cb113-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> term</span>
<span id="cb113-93"><a href="#cb113-93" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span>  <span class="fu">select</span>(<span class="dv">6</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb113-94"><a href="#cb113-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb113-95"><a href="#cb113-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb113-96"><a href="#cb113-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_low =</span> <span class="fu">min</span>(estimate <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb113-97"><a href="#cb113-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_high =</span> <span class="fu">max</span>(estimate <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb113-98"><a href="#cb113-98" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb113-99"><a href="#cb113-99" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">lag =</span> lag_value)</span>
<span id="cb113-100"><a href="#cb113-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-101"><a href="#cb113-101" aria-hidden="true" tabindex="-1"></a>    adj_r_squared <span class="ot">&lt;-</span> <span class="fu">glance</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb113-102"><a href="#cb113-102" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(r_squared, AIC, adj_r_squared)</span>
<span id="cb113-103"><a href="#cb113-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb113-104"><a href="#cb113-104" aria-hidden="true" tabindex="-1"></a>    mod_results <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_results, adj_r_squared) <span class="sc">|&gt;</span></span>
<span id="cb113-105"><a href="#cb113-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(estimate, std.error, statistic, p.value, conf_low, conf_high, adj_r_squared), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb113-106"><a href="#cb113-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">significance =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb113-107"><a href="#cb113-107" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>))</span>
<span id="cb113-108"><a href="#cb113-108" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb113-109"><a href="#cb113-109" aria-hidden="true" tabindex="-1"></a>    result_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_df, mod_results)</span>
<span id="cb113-110"><a href="#cb113-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-111"><a href="#cb113-111" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb113-112"><a href="#cb113-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result_df)</span>
<span id="cb113-113"><a href="#cb113-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-114"><a href="#cb113-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-115"><a href="#cb113-115" aria-hidden="true" tabindex="-1"></a>non_diff_indivi_with_NA <span class="ot">&lt;-</span> <span class="fu">run_lag_models</span>(df_1_trend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
    Min      1Q  Median      3Q     Max 
-0.7266 -0.1578  0.0911  0.2261  0.5408 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     0.87918    0.03355  26.209   &lt;2e-16 ***
cam_incidence   0.15911    0.22709   0.701   0.4851    
shp_incidence   0.97554    0.62776   1.554   0.1233    
catt_incidence  0.23064    0.13455   1.714   0.0895 .  
goat_incidence -0.02506    0.05387  -0.465   0.6428    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3179 on 103 degrees of freedom
Multiple R-squared: 0.0758, Adjusted R-squared: 0.0399
F-statistic: 2.112 on 4 and 103 DF, p-value: 0.084635
Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.74358 -0.11750  0.05283  0.22167  0.47940 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     0.89177    0.03339  26.707   &lt;2e-16 ***
cam_incidence   0.12606    0.22486   0.561   0.5763    
shp_incidence   1.07181    0.62166   1.724   0.0877 .  
catt_incidence  0.17900    0.13329   1.343   0.1823    
goat_incidence -0.02870    0.05335  -0.538   0.5917    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3148 on 102 degrees of freedom
Multiple R-squared: 0.05722,    Adjusted R-squared: 0.02024
F-statistic: 1.548 on 4 and 102 DF, p-value: 0.19413
Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.73671 -0.12186  0.05724  0.21880  0.51482 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     0.89661    0.03267  27.445   &lt;2e-16 ***
cam_incidence   0.12965    0.21882   0.593   0.5548    
shp_incidence   1.22441    0.60500   2.024   0.0456 *  
catt_incidence  0.17812    0.12977   1.373   0.1729    
goat_incidence -0.03005    0.05192  -0.579   0.5641    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3063 on 101 degrees of freedom
Multiple R-squared: 0.06858,    Adjusted R-squared: 0.03169
F-statistic: 1.859 on 4 and 101 DF, p-value: 0.12348
Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.74004 -0.11984  0.05346  0.18815  0.48826 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     0.89994    0.03194  28.175   &lt;2e-16 ***
cam_incidence   0.16581    0.21277   0.779   0.4376    
shp_incidence   1.02029    0.58835   1.734   0.0860 .  
catt_incidence  0.22751    0.12624   1.802   0.0745 .  
goat_incidence -0.03432    0.05049  -0.680   0.4982    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2978 on 100 degrees of freedom
Multiple R-squared: 0.08157,    Adjusted R-squared: 0.04483
F-statistic:  2.22 on 4 and 100 DF, p-value: 0.072126</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>non_diff_indivi_without_NA <span class="ot">&lt;-</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete_run_lag_models</span>(df_1_trend_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.84860 -0.11488  0.04294  0.16120  0.41882 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     1.004848   0.043141  23.292   &lt;2e-16 ***
catt_incidence  0.114544   0.118264   0.969    0.338    
goat_incidence -0.005748   0.045086  -0.127    0.899    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2622 on 46 degrees of freedom
Multiple R-squared: 0.04234,    Adjusted R-squared: 0.0007068
F-statistic: 1.017 on 2 and 46 DF, p-value: 0.36967
Series: human_incidence 
Model: TSLM 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.88147 -0.12067  0.00746  0.16625  0.38477 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    1.039113   0.040050  25.945   &lt;2e-16 ***
catt_incidence 0.034544   0.108609   0.318    0.752    
goat_incidence 0.005222   0.041319   0.126    0.900    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2401 on 45 degrees of freedom
Multiple R-squared: 0.01066,    Adjusted R-squared: -0.03331
F-statistic: 0.2425 on 2 and 45 DF, p-value: 0.78571
Series: human_incidence 
Model: TSLM 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.52295 -0.12363  0.02954  0.14731  0.36752 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    1.055838   0.033949  31.100   &lt;2e-16 ***
catt_incidence 0.038460   0.091059   0.422    0.675    
goat_incidence 0.007845   0.034565   0.227    0.822    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2007 on 44 degrees of freedom
Multiple R-squared: 0.02277,    Adjusted R-squared: -0.02165
F-statistic: 0.5125 on 2 and 44 DF, p-value: 0.60252
Series: human_incidence 
Model: TSLM 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.466496 -0.123334  0.008342  0.136314  0.349946 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     1.081553   0.032282  33.503   &lt;2e-16 ***
catt_incidence -0.010042   0.085607  -0.117    0.907    
goat_incidence  0.005739   0.032421   0.177    0.860    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.188 on 43 degrees of freedom
Multiple R-squared: 0.0007612,  Adjusted R-squared: -0.04572
F-statistic: 0.01638 on 2 and 43 DF, p-value: 0.98376</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>diff_indivi <span class="ot">&lt;-</span> <span class="fu">run_lag_models</span>(df_1_trend_diff <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'incidence'</span>), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.386594 -0.066171  0.007478  0.082536  0.249146 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)      0.006222   0.012200   0.510    0.611
cam_incidence  -18.527691  17.256709  -1.074    0.286
shp_incidence    0.116650   0.368165   0.317    0.752
catt_incidence   0.039857   0.040692   0.979    0.330
goat_incidence  -0.057560   0.075005  -0.767    0.445

Residual standard error: 0.1253 on 102 degrees of freedom
Multiple R-squared: 0.02158,    Adjusted R-squared: -0.01679
F-statistic: 0.5625 on 4 and 102 DF, p-value: 0.69041
Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.413173 -0.063748  0.006477  0.076952  0.239656 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)     0.007373   0.011809   0.624  0.53382   
cam_incidence  65.712533  52.578727   1.250  0.21426   
shp_incidence  -0.375130   0.353663  -1.061  0.29136   
catt_incidence -0.094868   0.039090  -2.427  0.01700 * 
goat_incidence  0.208432   0.072060   2.892  0.00468 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1203 on 101 degrees of freedom
Multiple R-squared: 0.1062, Adjusted R-squared: 0.07077
F-statistic: 2.999 on 4 and 101 DF, p-value: 0.021975
Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.410457 -0.063757  0.006243  0.083743  0.252240 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.004657   0.012417   0.375    0.708
cam_incidence         NA         NA      NA       NA
shp_incidence  -0.211110   0.371877  -0.568    0.572
catt_incidence  0.006058   0.041103   0.147    0.883
goat_incidence -0.065731   0.075771  -0.867    0.388

Residual standard error: 0.1265 on 101 degrees of freedom
Multiple R-squared: 0.01143,    Adjusted R-squared: -0.01793
F-statistic: 0.3893 on 3 and 101 DF, p-value: 0.76096
Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.412447 -0.066177  0.005648  0.082223  0.250031 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.006652   0.012521   0.531    0.596
cam_incidence         NA         NA      NA       NA
shp_incidence   0.389456   0.373215   1.044    0.299
catt_incidence  0.025046   0.041243   0.607    0.545
goat_incidence -0.018898   0.076028  -0.249    0.804

Residual standard error: 0.1269 on 100 degrees of freedom
Multiple R-squared: 0.01396,    Adjusted R-squared: -0.01563
F-statistic: 0.4718 on 3 and 100 DF, p-value: 0.70262</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(non_diff_indivi_with_NA <span class="sc">|&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>r_squared, <span class="sc">-</span>AIC, <span class="sc">-</span>adj_r_squared), <span class="st">"non_diff_individual_with_NA.csv"</span>)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(non_diff_indivi_without_NA <span class="sc">|&gt;</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>r_squared, <span class="sc">-</span>AIC, <span class="sc">-</span>adj_r_squared), <span class="st">"non_diff_individual_without_NA.csv"</span>)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(diff_indivi, <span class="st">"diff_individual.csv"</span>)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="do">## The following function fits the model, without differencing, at difference lags, (0-3) and for</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="do">## animal incidences combined</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>lag_models_full <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">max_lag =</span> <span class="dv">3</span>, ...) {</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>  result_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (lag_value <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_lag) {</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>    df_lagged <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">vars</span>(animal_incidence),</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">list</span>(<span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> lag_value))) <span class="sc">|&gt;</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> df_lagged <span class="sc">|&gt;</span></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(<span class="fu">TSLM</span>((human_incidence) <span class="sc">~</span> animal_incidence)) <span class="sc">|&gt;</span></span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">report</span>()</span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>    mod_results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">%&gt;%</span></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>          term <span class="sc">==</span> <span class="st">"animal_incidence"</span> <span class="sc">~</span> <span class="st">"Animal Incidence"</span>,</span>
<span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term)</span>
<span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb119-36"><a href="#cb119-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">variable =</span> term</span>
<span id="cb119-37"><a href="#cb119-37" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span>  <span class="fu">select</span>(<span class="dv">6</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb119-38"><a href="#cb119-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb119-39"><a href="#cb119-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb119-40"><a href="#cb119-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_low =</span> <span class="fu">min</span>(estimate <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb119-41"><a href="#cb119-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_high =</span> <span class="fu">max</span>(estimate <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb119-42"><a href="#cb119-42" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb119-43"><a href="#cb119-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">lag =</span> lag_value)</span>
<span id="cb119-44"><a href="#cb119-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-45"><a href="#cb119-45" aria-hidden="true" tabindex="-1"></a>    adj_r_squared <span class="ot">&lt;-</span> <span class="fu">glance</span>(mod) <span class="sc">|&gt;</span></span>
<span id="cb119-46"><a href="#cb119-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(r_squared, adj_r_squared, AIC) <span class="sc">|&gt;</span></span>
<span id="cb119-47"><a href="#cb119-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb119-48"><a href="#cb119-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-49"><a href="#cb119-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-50"><a href="#cb119-50" aria-hidden="true" tabindex="-1"></a>    mod_results <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_results, adj_r_squared) <span class="sc">|&gt;</span></span>
<span id="cb119-51"><a href="#cb119-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb119-52"><a href="#cb119-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb119-53"><a href="#cb119-53" aria-hidden="true" tabindex="-1"></a>          estimate,</span>
<span id="cb119-54"><a href="#cb119-54" aria-hidden="true" tabindex="-1"></a>          std.error,</span>
<span id="cb119-55"><a href="#cb119-55" aria-hidden="true" tabindex="-1"></a>          statistic,</span>
<span id="cb119-56"><a href="#cb119-56" aria-hidden="true" tabindex="-1"></a>          p.value,</span>
<span id="cb119-57"><a href="#cb119-57" aria-hidden="true" tabindex="-1"></a>          conf_low,</span>
<span id="cb119-58"><a href="#cb119-58" aria-hidden="true" tabindex="-1"></a>          conf_high,</span>
<span id="cb119-59"><a href="#cb119-59" aria-hidden="true" tabindex="-1"></a>          adj_r_squared</span>
<span id="cb119-60"><a href="#cb119-60" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb119-61"><a href="#cb119-61" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb119-62"><a href="#cb119-62" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">|&gt;</span></span>
<span id="cb119-63"><a href="#cb119-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">significance =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) </span>
<span id="cb119-64"><a href="#cb119-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-65"><a href="#cb119-65" aria-hidden="true" tabindex="-1"></a>    result_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_df, mod_results)</span>
<span id="cb119-66"><a href="#cb119-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-67"><a href="#cb119-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb119-68"><a href="#cb119-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-69"><a href="#cb119-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result_df)</span>
<span id="cb119-70"><a href="#cb119-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb119-71"><a href="#cb119-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-72"><a href="#cb119-72" aria-hidden="true" tabindex="-1"></a>non_diff_full_with_NA <span class="ot">&lt;-</span> <span class="fu">lag_models_full</span>(df_cum_trend <span class="sc">|&gt;</span> </span>
<span id="cb119-73"><a href="#cb119-73" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'incidence'</span>), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.74840 -0.12736  0.07724  0.22423  0.51900 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.90744    0.03163  28.689   &lt;2e-16 ***
animal_incidence  0.11629    0.06767   1.718   0.0886 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3215 on 106 degrees of freedom
Multiple R-squared: 0.0271, Adjusted R-squared: 0.01793
F-statistic: 2.953 on 1 and 106 DF, p-value: 0.088637</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.75967 -0.13346  0.07628  0.22781  0.49967 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.91847    0.03141  29.243   &lt;2e-16 ***
animal_incidence  0.07279    0.06689   1.088    0.279    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3177 on 105 degrees of freedom
Multiple R-squared: 0.01115,    Adjusted R-squared: 0.001734
F-statistic: 1.184 on 1 and 105 DF, p-value: 0.27901</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.76573 -0.13419  0.06972  0.21866  0.49909 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.92563    0.03090  29.959   &lt;2e-16 ***
animal_incidence  0.07000    0.06549   1.069    0.288    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3111 on 104 degrees of freedom
Multiple R-squared: 0.01087,    Adjusted R-squared: 0.001356
F-statistic: 1.143 on 1 and 104 DF, p-value: 0.28759</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.76995 -0.13787  0.07195  0.21685  0.47979 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.92985    0.03024  30.750   &lt;2e-16 ***
animal_incidence  0.09533    0.06380   1.494    0.138    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.303 on 103 degrees of freedom
Multiple R-squared: 0.02122,    Adjusted R-squared: 0.01171
F-statistic: 2.233 on 1 and 103 DF, p-value: 0.13817</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>non_diff_full_without_NA <span class="ot">&lt;-</span> <span class="fu">lag_models_full</span>(<span class="at">df =</span> df_cum_trend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.74840 -0.12736  0.07724  0.22423  0.51900 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.90744    0.03163  28.689   &lt;2e-16 ***
animal_incidence  0.11629    0.06767   1.718   0.0886 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3215 on 106 degrees of freedom
Multiple R-squared: 0.0271, Adjusted R-squared: 0.01793
F-statistic: 2.953 on 1 and 106 DF, p-value: 0.088637</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.75967 -0.13346  0.07628  0.22781  0.49967 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.91847    0.03141  29.243   &lt;2e-16 ***
animal_incidence  0.07279    0.06689   1.088    0.279    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3177 on 105 degrees of freedom
Multiple R-squared: 0.01115,    Adjusted R-squared: 0.001734
F-statistic: 1.184 on 1 and 105 DF, p-value: 0.27901</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.76573 -0.13419  0.06972  0.21866  0.49909 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.92563    0.03090  29.959   &lt;2e-16 ***
animal_incidence  0.07000    0.06549   1.069    0.288    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3111 on 104 degrees of freedom
Multiple R-squared: 0.01087,    Adjusted R-squared: 0.001356
F-statistic: 1.143 on 1 and 104 DF, p-value: 0.28759</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.76995 -0.13787  0.07195  0.21685  0.47979 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       0.92985    0.03024  30.750   &lt;2e-16 ***
animal_incidence  0.09533    0.06380   1.494    0.138    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.303 on 103 degrees of freedom
Multiple R-squared: 0.02122,    Adjusted R-squared: 0.01171
F-statistic: 2.233 on 1 and 103 DF, p-value: 0.13817</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>diff_full <span class="ot">&lt;-</span> <span class="fu">lag_models_full</span>(df_cum_trend_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
       Min         1Q     Median         3Q        Max 
-0.4087348 -0.0635705 -0.0008561  0.0813921  0.2519912 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)      0.005663   0.011879   0.477   0.6346  
animal_incidence 0.033347   0.018293   1.823   0.0712 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1229 on 105 degrees of freedom
Multiple R-squared: 0.03068,    Adjusted R-squared: 0.02145
F-statistic: 3.323 on 1 and 105 DF, p-value: 0.071158</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.408009 -0.073618  0.007568  0.083920  0.251737 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)       0.00568    0.01211   0.469    0.640
animal_incidence -0.02037    0.01856  -1.097    0.275

Residual standard error: 0.1247 on 104 degrees of freedom
Multiple R-squared: 0.01144,    Adjusted R-squared: 0.001939
F-statistic: 1.204 on 1 and 104 DF, p-value: 0.27505</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.411473 -0.066265  0.008535  0.084835  0.251244 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)       0.005465   0.012262   0.446    0.657
animal_incidence -0.014059   0.018706  -0.752    0.454

Residual standard error: 0.1257 on 103 degrees of freedom
Multiple R-squared: 0.005454,   Adjusted R-squared: -0.004202
F-statistic: 0.5648 on 1 and 103 DF, p-value: 0.45403</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: TSLM 
Transformation: (human_incidence) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.411774 -0.068145  0.006532  0.083605  0.250940 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)      0.005768   0.012279    0.47    0.640
animal_incidence 0.027778   0.018641    1.49    0.139

Residual standard error: 0.1252 on 102 degrees of freedom
Multiple R-squared: 0.02131,    Adjusted R-squared: 0.01171
F-statistic: 2.221 on 1 and 102 DF, p-value: 0.13927</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(non_diff_full_with_NA <span class="sc">|&gt;</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>r_squared, <span class="sc">-</span>AIC, <span class="sc">-</span>adj_r_squared), <span class="st">"non_diff_full_with_NA.csv"</span>)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(non_diff_full_without_NA <span class="sc">|&gt;</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>r_squared, <span class="sc">-</span>AIC, <span class="sc">-</span>adj_r_squared), <span class="st">"non_diff_full_without_NA.csv"</span>)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co"># write_csv(non_diff_full, "non_diff_full.csv")</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="co"># write_csv(diff_full, "diff_full.csv")</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Getting the AIC, R-Squared and Adjusted R squared for each lag</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>Table_lag_indivi_withoutNA <span class="ot">&lt;-</span> non_diff_indivi_without_NA <span class="sc">|&gt;</span> </span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Lag =</span> lag, <span class="st">`</span><span class="at">R-Squared(%)</span><span class="st">`</span> <span class="ot">=</span> r_squared, <span class="st">`</span><span class="at">Adjusted R-Squared(%)</span><span class="st">`</span> <span class="ot">=</span> adj_r_squared, AIC) <span class="sc">|&gt;</span> </span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">R-Squared(%)</span><span class="st">`</span> , <span class="st">`</span><span class="at">Adjusted R-Squared(%)</span><span class="st">`</span>, ), <span class="sc">~</span> (. <span class="sc">*</span> <span class="dv">100</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">2</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Adjusted R-Squared(%)</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"l"</span>,</span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"The AIC, R-Squared and Adjusted R-Squared for each lag for individual species. The data as been arranged in decreasing order of Adjusted R-Squared"</span>,</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"pipe"</span>,</span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">latex_options =</span> <span class="st">"hold_position"</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>Table_lag_indivi_withoutNA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>The AIC, R-Squared and Adjusted R-Squared for each lag for individual species. The data as been arranged in decreasing order of Adjusted R-Squared</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Lag</th>
<th style="text-align: left;">R-Squared(%)</th>
<th style="text-align: left;">Adjusted R-Squared(%)</th>
<th style="text-align: left;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">4.23</td>
<td style="text-align: left;">0.1</td>
<td style="text-align: left;">-126.28</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">2.28</td>
<td style="text-align: left;">-2.2</td>
<td style="text-align: left;">-146.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1.07</td>
<td style="text-align: left;">-3.3</td>
<td style="text-align: left;">-132.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">-4.6</td>
<td style="text-align: left;">-148.84</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>Table_lag_full <span class="ot">&lt;-</span> non_diff_full_without_NA <span class="sc">|&gt;</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Lag =</span> lag, <span class="st">`</span><span class="at">R-Squared(%)</span><span class="st">`</span> <span class="ot">=</span> r_squared, <span class="st">`</span><span class="at">Adjusted R-Squared(%)</span><span class="st">`</span> <span class="ot">=</span> adj_r_squared, AIC) <span class="sc">|&gt;</span> </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">R-Squared(%)</span><span class="st">`</span> , <span class="st">`</span><span class="at">Adjusted R-Squared(%)</span><span class="st">`</span>, ), <span class="sc">~</span> (. <span class="sc">*</span> <span class="dv">100</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">2</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Adjusted R-Squared(%)</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"l"</span>,</span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"The AIC, R-Squared and Adjusted R-Squared for each lag for combined species. The data as been arranged in decreasing order of Adjusted R-Squared"</span>,</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"pipe"</span>,</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">latex_options =</span> <span class="st">"hold_position"</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>Table_lag_full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>The AIC, R-Squared and Adjusted R-Squared for each lag for combined species. The data as been arranged in decreasing order of Adjusted R-Squared</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Lag</th>
<th style="text-align: left;">R-Squared(%)</th>
<th style="text-align: left;">Adjusted R-Squared(%)</th>
<th style="text-align: left;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">2.71</td>
<td style="text-align: left;">1.8</td>
<td style="text-align: left;">-241.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">2.12</td>
<td style="text-align: left;">1.2</td>
<td style="text-align: left;">-246.80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1.12</td>
<td style="text-align: left;">0.2</td>
<td style="text-align: left;">-241.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">1.09</td>
<td style="text-align: left;">0.1</td>
<td style="text-align: left;">-243.58</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag 2</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>df_2_2 <span class="ot">&lt;-</span> df_1 <span class="sc">|&gt;</span> </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">2</span>))) <span class="sc">|&gt;</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag 3</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>df_2_3 <span class="ot">&lt;-</span> df_1 <span class="sc">|&gt;</span> </span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(catt_incidence, cam_incidence, goat_incidence, shp_incidence),</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>fit_county_model <span class="ot">&lt;-</span> <span class="cf">function</span>(county_name, data, type) {</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data for the specific county</span></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>  county_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, county <span class="sc">==</span> county_name)</span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"full"</span>)</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if all incidences are zero</span></span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(county_data<span class="sc">$</span>animal_incidence <span class="sc">==</span> <span class="dv">0</span>)) {</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Skipping model for"</span>, county_name, <span class="st">"as all incidences are zero."</span>))</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the model</span></span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a>    mod_county <span class="ot">&lt;-</span> county_data <span class="sc">|&gt;</span></span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">TSLM</span>(</span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a>          human_incidence <span class="sc">~</span> animal_incidence</span>
<span id="cb148-36"><a href="#cb148-36" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb148-37"><a href="#cb148-37" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb148-38"><a href="#cb148-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-39"><a href="#cb148-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">|&gt;</span></span>
<span id="cb148-40"><a href="#cb148-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-41"><a href="#cb148-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb148-42"><a href="#cb148-42" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"animal_incidence"</span> <span class="sc">~</span> <span class="st">"Animal Incidence"</span>,</span>
<span id="cb148-43"><a href="#cb148-43" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term) </span>
<span id="cb148-44"><a href="#cb148-44" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb148-45"><a href="#cb148-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> term</span>
<span id="cb148-46"><a href="#cb148-46" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span>  </span>
<span id="cb148-47"><a href="#cb148-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="dv">6</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb148-48"><a href="#cb148-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb148-49"><a href="#cb148-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb148-50"><a href="#cb148-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_low =</span> <span class="fu">min</span>(estimate <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb148-51"><a href="#cb148-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_high =</span> <span class="fu">max</span>(estimate <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb148-52"><a href="#cb148-52" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb148-53"><a href="#cb148-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-54"><a href="#cb148-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"individual"</span>) {</span>
<span id="cb148-55"><a href="#cb148-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if all incidences are zero</span></span>
<span id="cb148-56"><a href="#cb148-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(county_data<span class="sc">$</span>catt_incidence <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb148-57"><a href="#cb148-57" aria-hidden="true" tabindex="-1"></a>          county_data<span class="sc">$</span>cam_incidence <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb148-58"><a href="#cb148-58" aria-hidden="true" tabindex="-1"></a>          county_data<span class="sc">$</span>goat_incidence <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb148-59"><a href="#cb148-59" aria-hidden="true" tabindex="-1"></a>          county_data<span class="sc">$</span>shp_incidence <span class="sc">==</span> <span class="dv">0</span>)) {</span>
<span id="cb148-60"><a href="#cb148-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Skipping model for"</span>, county_name, <span class="st">"as all incidences are zero."</span>))</span>
<span id="cb148-61"><a href="#cb148-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb148-62"><a href="#cb148-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-63"><a href="#cb148-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-64"><a href="#cb148-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb148-65"><a href="#cb148-65" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> county_data <span class="sc">|&gt;</span></span>
<span id="cb148-66"><a href="#cb148-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-67"><a href="#cb148-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">model</span>(</span>
<span id="cb148-68"><a href="#cb148-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">TSLM</span>(</span>
<span id="cb148-69"><a href="#cb148-69" aria-hidden="true" tabindex="-1"></a>        human_incidence <span class="sc">~</span> catt_incidence <span class="sc">+</span> goat_incidence <span class="sc">+</span> shp_incidence <span class="sc">+</span>cam_incidence</span>
<span id="cb148-70"><a href="#cb148-70" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb148-71"><a href="#cb148-71" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb148-72"><a href="#cb148-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-73"><a href="#cb148-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">|&gt;</span></span>
<span id="cb148-74"><a href="#cb148-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-75"><a href="#cb148-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb148-76"><a href="#cb148-76" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span> <span class="st">"Goat Incidence"</span>,</span>
<span id="cb148-77"><a href="#cb148-77" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"catt_incidence"</span> <span class="sc">~</span> <span class="st">"Cattle incidence"</span>,</span>
<span id="cb148-78"><a href="#cb148-78" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"shp_incidence"</span> <span class="sc">~</span> <span class="st">"Sheep incidence"</span>,</span>
<span id="cb148-79"><a href="#cb148-79" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"cam_incidence"</span> <span class="sc">~</span> <span class="st">"Camel incidence"</span>,</span>
<span id="cb148-80"><a href="#cb148-80" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term) </span>
<span id="cb148-81"><a href="#cb148-81" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb148-82"><a href="#cb148-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> term</span>
<span id="cb148-83"><a href="#cb148-83" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>  </span>
<span id="cb148-84"><a href="#cb148-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="dv">6</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb148-85"><a href="#cb148-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb148-86"><a href="#cb148-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb148-87"><a href="#cb148-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_low =</span> <span class="fu">min</span>(estimate <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb148-88"><a href="#cb148-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_high =</span> <span class="fu">max</span>(estimate <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb148-89"><a href="#cb148-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb148-90"><a href="#cb148-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-91"><a href="#cb148-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mod_county)</span>
<span id="cb148-92"><a href="#cb148-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-93"><a href="#cb148-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-94"><a href="#cb148-94" aria-hidden="true" tabindex="-1"></a>county_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_2_2<span class="sc">$</span>county)</span>
<span id="cb148-95"><a href="#cb148-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-96"><a href="#cb148-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store the models for each county</span></span>
<span id="cb148-97"><a href="#cb148-97" aria-hidden="true" tabindex="-1"></a>models_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb148-98"><a href="#cb148-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-99"><a href="#cb148-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the data frame for each county</span></span>
<span id="cb148-100"><a href="#cb148-100" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">county =</span> <span class="fu">character</span>(), </span>
<span id="cb148-101"><a href="#cb148-101" aria-hidden="true" tabindex="-1"></a>                              <span class="at">variable =</span> <span class="fu">character</span>(),</span>
<span id="cb148-102"><a href="#cb148-102" aria-hidden="true" tabindex="-1"></a>                              <span class="at">estimate =</span> <span class="fu">numeric</span>(),</span>
<span id="cb148-103"><a href="#cb148-103" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-104"><a href="#cb148-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-105"><a href="#cb148-105" aria-hidden="true" tabindex="-1"></a><span class="co"># At lag 2</span></span>
<span id="cb148-106"><a href="#cb148-106" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (county_name <span class="cf">in</span> county_names) {</span>
<span id="cb148-107"><a href="#cb148-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Fitting model for"</span>, county_name))</span>
<span id="cb148-108"><a href="#cb148-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-109"><a href="#cb148-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-110"><a href="#cb148-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-111"><a href="#cb148-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb148-112"><a href="#cb148-112" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> <span class="fu">fit_county_model</span>(county_name, df_2_2, <span class="at">type =</span> <span class="st">"individual"</span>)</span>
<span id="cb148-113"><a href="#cb148-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-114"><a href="#cb148-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if model fitting was successful</span></span>
<span id="cb148-115"><a href="#cb148-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_county)) {</span>
<span id="cb148-116"><a href="#cb148-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients, round off, and add to the data frame</span></span>
<span id="cb148-117"><a href="#cb148-117" aria-hidden="true" tabindex="-1"></a>    coefficients_df_lag2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coefficients_df_lag2, </span>
<span id="cb148-118"><a href="#cb148-118" aria-hidden="true" tabindex="-1"></a>                                 mod_county <span class="sc">%&gt;%</span> </span>
<span id="cb148-119"><a href="#cb148-119" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">mutate</span>(<span class="at">county =</span> county_name,</span>
<span id="cb148-120"><a href="#cb148-120" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>)))</span>
<span id="cb148-121"><a href="#cb148-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-122"><a href="#cb148-122" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for Baringo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.
Fitting model for Bomet

Using `date` as index variable.
Fitting model for Bungoma

Using `date` as index variable.
Fitting model for Busia

Using `date` as index variable.
Fitting model for Elgeyo Marakwet

Using `date` as index variable.
Fitting model for Embu

Using `date` as index variable.
Fitting model for Garissa

Using `date` as index variable.
Fitting model for Homa Bay

Skipping model for Homa Bay as all incidences are zero.

Fitting model for Isiolo

Using `date` as index variable.
Fitting model for Kajiado

Using `date` as index variable.
Fitting model for Kakamega

Using `date` as index variable.
Fitting model for Kericho

Skipping model for Kericho as all incidences are zero.

Fitting model for Kiambu

Skipping model for Kiambu as all incidences are zero.

Fitting model for Kilifi

Using `date` as index variable.
Fitting model for Kirinyaga

Skipping model for Kirinyaga as all incidences are zero.

Fitting model for Kisii

Skipping model for Kisii as all incidences are zero.

Fitting model for Kisumu

Skipping model for Kisumu as all incidences are zero.

Fitting model for Kitui

Using `date` as index variable.
Fitting model for Kwale

Using `date` as index variable.
Fitting model for Laikipia

Using `date` as index variable.
Fitting model for Lamu

Skipping model for Lamu as all incidences are zero.

Fitting model for Machakos

Using `date` as index variable.
Fitting model for Makueni

Using `date` as index variable.
Fitting model for Mandera

Using `date` as index variable.
Fitting model for Marsabit

Using `date` as index variable.
Fitting model for Meru

Using `date` as index variable.
Fitting model for Migori

Skipping model for Migori as all incidences are zero.

Fitting model for Mombasa

Using `date` as index variable.
Fitting model for Murang'a

Skipping model for Murang'a as all incidences are zero.

Fitting model for Nairobi

Skipping model for Nairobi as all incidences are zero.

Fitting model for Nakuru

Using `date` as index variable.
Fitting model for Nandi

Using `date` as index variable.
Fitting model for Narok

Using `date` as index variable.
Fitting model for Nyamira

Skipping model for Nyamira as all incidences are zero.

Fitting model for Nyandarua

Skipping model for Nyandarua as all incidences are zero.

Fitting model for Nyeri

Skipping model for Nyeri as all incidences are zero.

Fitting model for Samburu

Using `date` as index variable.
Fitting model for Siaya

Using `date` as index variable.
Fitting model for Taita Taveta

Using `date` as index variable.
Fitting model for Tana River

Using `date` as index variable.
Fitting model for Tharaka Nithi

Using `date` as index variable.
Fitting model for Trans Nzoia

Using `date` as index variable.
Fitting model for Turkana

Using `date` as index variable.
Fitting model for Uasin Gishu

Using `date` as index variable.
Fitting model for Vihiga

Using `date` as index variable.
Fitting model for Wajir

Using `date` as index variable.
Fitting model for West Pokot

Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag2 <span class="ot">&lt;-</span> coefficients_df_lag2 <span class="sc">|&gt;</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>)))</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(coefficients_df_lag2, <span class="st">"individual_animal_incidence_per_county_lag2.csv"</span>)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="co"># At lag 3</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">county =</span> <span class="fu">character</span>(), </span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variable =</span> <span class="fu">character</span>(),</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">estimate =</span> <span class="fu">numeric</span>(),</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (county_name <span class="cf">in</span> county_names) {</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Fitting model for"</span>, county_name))</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> <span class="fu">fit_county_model</span>(county_name, df_2_3, <span class="at">type =</span> <span class="st">"individual"</span>)</span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if model fitting was successful</span></span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_county)) {</span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients, round off, and add to the data frame</span></span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>    coefficients_df_lag3 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coefficients_df_lag3, </span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>                                 mod_county <span class="sc">%&gt;%</span> </span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">mutate</span>(<span class="at">county =</span> county_name,</span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>)))</span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for Baringo
Using `date` as index variable.Fitting model for Bomet
Using `date` as index variable.Fitting model for Bungoma
Using `date` as index variable.Fitting model for Busia
Using `date` as index variable.Fitting model for Elgeyo Marakwet
Using `date` as index variable.Fitting model for Embu
Using `date` as index variable.Fitting model for Garissa
Using `date` as index variable.Fitting model for Homa Bay
Skipping model for Homa Bay as all incidences are zero.
Fitting model for Isiolo
Using `date` as index variable.Fitting model for Kajiado
Using `date` as index variable.Fitting model for Kakamega
Using `date` as index variable.Fitting model for Kericho
Skipping model for Kericho as all incidences are zero.
Fitting model for Kiambu
Skipping model for Kiambu as all incidences are zero.
Fitting model for Kilifi
Using `date` as index variable.Fitting model for Kirinyaga
Skipping model for Kirinyaga as all incidences are zero.
Fitting model for Kisii
Skipping model for Kisii as all incidences are zero.
Fitting model for Kisumu
Skipping model for Kisumu as all incidences are zero.
Fitting model for Kitui
Using `date` as index variable.Fitting model for Kwale
Using `date` as index variable.Fitting model for Laikipia
Using `date` as index variable.Fitting model for Lamu
Skipping model for Lamu as all incidences are zero.
Fitting model for Machakos
Using `date` as index variable.Fitting model for Makueni
Using `date` as index variable.Fitting model for Mandera
Using `date` as index variable.Fitting model for Marsabit
Using `date` as index variable.Fitting model for Meru
Using `date` as index variable.Fitting model for Migori
Skipping model for Migori as all incidences are zero.
Fitting model for Mombasa
Using `date` as index variable.Fitting model for Murang'a
Skipping model for Murang'a as all incidences are zero.
Fitting model for Nairobi
Skipping model for Nairobi as all incidences are zero.
Fitting model for Nakuru
Using `date` as index variable.Fitting model for Nandi
Using `date` as index variable.Fitting model for Narok
Using `date` as index variable.Fitting model for Nyamira
Skipping model for Nyamira as all incidences are zero.
Fitting model for Nyandarua
Skipping model for Nyandarua as all incidences are zero.
Fitting model for Nyeri
Skipping model for Nyeri as all incidences are zero.
Fitting model for Samburu
Using `date` as index variable.Fitting model for Siaya
Using `date` as index variable.Fitting model for Taita Taveta
Using `date` as index variable.Fitting model for Tana River
Using `date` as index variable.Fitting model for Tharaka Nithi
Using `date` as index variable.Fitting model for Trans Nzoia
Using `date` as index variable.Fitting model for Turkana
Using `date` as index variable.Fitting model for Uasin Gishu
Using `date` as index variable.Fitting model for Vihiga
Using `date` as index variable.Fitting model for Wajir
Using `date` as index variable.Fitting model for West Pokot
Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag3 <span class="ot">&lt;-</span> coefficients_df_lag3 <span class="sc">|&gt;</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>)))</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(coefficients_df_lag3, <span class="st">"individual_animal_incidence_per_county_lag3.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag 2</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>df_cum_2_2 <span class="ot">&lt;-</span> df_cum <span class="sc">|&gt;</span> </span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(animal_incidence),</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">2</span>))) <span class="sc">|&gt;</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag 3</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>df_cum_2_3 <span class="ot">&lt;-</span> df_cum <span class="sc">|&gt;</span> </span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(animal_incidence),</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>( <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">3</span>))) <span class="sc">|&gt;</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="co"># At lag 2</span></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>county_names2_2 <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_cum_2_2<span class="sc">$</span>county)</span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store the models for each county</span></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a>models_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the data frame for each county</span></span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a>coefficients_df2_lag2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">county =</span> <span class="fu">character</span>(), </span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a>                              <span class="at">variable =</span> <span class="fu">character</span>(),</span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a>                              <span class="at">estimate =</span> <span class="fu">numeric</span>(),</span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-29"><a href="#cb154-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (county_name <span class="cf">in</span> county_names2_2) {</span>
<span id="cb154-30"><a href="#cb154-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Fitting model for"</span>, county_name))</span>
<span id="cb154-31"><a href="#cb154-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-32"><a href="#cb154-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-33"><a href="#cb154-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-34"><a href="#cb154-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb154-35"><a href="#cb154-35" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> <span class="fu">fit_county_model</span>(county_name, df_cum_2_2, <span class="at">type =</span> <span class="st">"full"</span>)</span>
<span id="cb154-36"><a href="#cb154-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-37"><a href="#cb154-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if model fitting was successful</span></span>
<span id="cb154-38"><a href="#cb154-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_county)) {</span>
<span id="cb154-39"><a href="#cb154-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients, round off, and add to the data frame</span></span>
<span id="cb154-40"><a href="#cb154-40" aria-hidden="true" tabindex="-1"></a>    coefficients_df2_lag2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coefficients_df2_lag2, </span>
<span id="cb154-41"><a href="#cb154-41" aria-hidden="true" tabindex="-1"></a>                                 mod_county <span class="sc">%&gt;%</span> </span>
<span id="cb154-42"><a href="#cb154-42" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">mutate</span>(<span class="at">county =</span> county_name,</span>
<span id="cb154-43"><a href="#cb154-43" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>)))</span>
<span id="cb154-44"><a href="#cb154-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb154-45"><a href="#cb154-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for Murang'a</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.
Fitting model for Mandera

Using `date` as index variable.
Fitting model for Vihiga

Using `date` as index variable.
Fitting model for West Pokot

Using `date` as index variable.
Fitting model for Marsabit

Using `date` as index variable.
Fitting model for Elgeyo Marakwet

Using `date` as index variable.
Fitting model for Embu

Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>coefficients_df2_lag2 <span class="ot">&lt;-</span> coefficients_df2_lag2 <span class="sc">|&gt;</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(coefficients_df2_lag2, <span class="st">"all_animal_incidence_per_county_lag2.csv"</span>)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="co"># At lag 3</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>county_names2_3 <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_cum_2_3<span class="sc">$</span>county)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store the models for each county</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>models_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the data frame for each county</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>coefficients_df2_lag3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">county =</span> <span class="fu">character</span>(), </span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">variable =</span> <span class="fu">character</span>(),</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">estimate =</span> <span class="fu">numeric</span>(),</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (county_name <span class="cf">in</span> county_names2_3) {</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Fitting model for"</span>, county_name))</span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> <span class="fu">fit_county_model</span>(county_name, df_cum_2_3, <span class="at">type =</span> <span class="st">"full"</span>)</span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if model fitting was successful</span></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_county)) {</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients, round off, and add to the data frame</span></span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>    coefficients_df2_lag3 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coefficients_df2_lag3, </span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a>                                       mod_county <span class="sc">%&gt;%</span> </span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">mutate</span>(<span class="at">county =</span> county_name,</span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>)))</span>
<span id="cb157-34"><a href="#cb157-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-35"><a href="#cb157-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for Tharaka Nithi
Using `date` as index variable.Fitting model for Turkana
Using `date` as index variable.Fitting model for Trans Nzoia
Using `date` as index variable.Fitting model for Nyamira
Using `date` as index variable.Fitting model for Vihiga
Using `date` as index variable.Fitting model for Bungoma
Using `date` as index variable.Fitting model for Marsabit
Using `date` as index variable.Fitting model for Embu
Using `date` as index variable.Fitting model for Isiolo
Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>coefficients_df2_lag3 <span class="ot">&lt;-</span> coefficients_df2_lag3 <span class="sc">|&gt;</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(coefficients_df2_lag3, <span class="st">"all_animal_incidence_per_county_lag3.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag 2</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>df_2_2_complete <span class="ot">&lt;-</span> df_1_complete <span class="sc">|&gt;</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(catt_incidence, goat_incidence),</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">2</span>))</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag 3</span></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>df_2_3_complete  <span class="ot">&lt;-</span> df_1_complete  <span class="sc">|&gt;</span></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(</span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(catt_incidence, goat_incidence),</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(., <span class="at">n =</span> <span class="dv">4</span>))</span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a>fit_county_model_complete <span class="ot">&lt;-</span> <span class="cf">function</span>(county_name, data, type) {</span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data for the specific county</span></span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a>  county_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, county <span class="sc">==</span> county_name)</span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb160-26"><a href="#cb160-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"full"</span>)</span>
<span id="cb160-27"><a href="#cb160-27" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb160-28"><a href="#cb160-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if all incidences are zero</span></span>
<span id="cb160-29"><a href="#cb160-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(county_data<span class="sc">$</span>animal_incidence <span class="sc">==</span> <span class="dv">0</span>)) {</span>
<span id="cb160-30"><a href="#cb160-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Skipping model for"</span>, county_name, <span class="st">"as all incidences are zero."</span>))</span>
<span id="cb160-31"><a href="#cb160-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb160-32"><a href="#cb160-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb160-33"><a href="#cb160-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb160-34"><a href="#cb160-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the model</span></span>
<span id="cb160-35"><a href="#cb160-35" aria-hidden="true" tabindex="-1"></a>    mod_county <span class="ot">&lt;-</span> county_data <span class="sc">|&gt;</span></span>
<span id="cb160-36"><a href="#cb160-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-37"><a href="#cb160-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">model</span>(</span>
<span id="cb160-38"><a href="#cb160-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">TSLM</span>(</span>
<span id="cb160-39"><a href="#cb160-39" aria-hidden="true" tabindex="-1"></a>          human_incidence <span class="sc">~</span> animal_incidence</span>
<span id="cb160-40"><a href="#cb160-40" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb160-41"><a href="#cb160-41" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb160-42"><a href="#cb160-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-43"><a href="#cb160-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">|&gt;</span></span>
<span id="cb160-44"><a href="#cb160-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-45"><a href="#cb160-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb160-46"><a href="#cb160-46" aria-hidden="true" tabindex="-1"></a>        term <span class="sc">==</span> <span class="st">"animal_incidence"</span> <span class="sc">~</span> <span class="st">"Animal Incidence"</span>,</span>
<span id="cb160-47"><a href="#cb160-47" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term) </span>
<span id="cb160-48"><a href="#cb160-48" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb160-49"><a href="#cb160-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> term</span>
<span id="cb160-50"><a href="#cb160-50" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span>  </span>
<span id="cb160-51"><a href="#cb160-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="dv">6</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb160-52"><a href="#cb160-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb160-53"><a href="#cb160-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb160-54"><a href="#cb160-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_low =</span> <span class="fu">min</span>(estimate <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb160-55"><a href="#cb160-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">conf_high =</span> <span class="fu">max</span>(estimate <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb160-56"><a href="#cb160-56" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb160-57"><a href="#cb160-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-58"><a href="#cb160-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"individual"</span>) {</span>
<span id="cb160-59"><a href="#cb160-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if all incidences are zero</span></span>
<span id="cb160-60"><a href="#cb160-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(county_data<span class="sc">$</span>catt_incidence <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb160-61"><a href="#cb160-61" aria-hidden="true" tabindex="-1"></a>          county_data<span class="sc">$</span>goat_incidence <span class="sc">==</span> <span class="dv">0</span> )) {</span>
<span id="cb160-62"><a href="#cb160-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Skipping model for"</span>, county_name, <span class="st">"as all incidences are zero."</span>))</span>
<span id="cb160-63"><a href="#cb160-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb160-64"><a href="#cb160-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-65"><a href="#cb160-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb160-66"><a href="#cb160-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb160-67"><a href="#cb160-67" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> county_data <span class="sc">|&gt;</span></span>
<span id="cb160-68"><a href="#cb160-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-69"><a href="#cb160-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">model</span>(</span>
<span id="cb160-70"><a href="#cb160-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">TSLM</span>(</span>
<span id="cb160-71"><a href="#cb160-71" aria-hidden="true" tabindex="-1"></a>        human_incidence <span class="sc">~</span> catt_incidence <span class="sc">+</span> goat_incidence</span>
<span id="cb160-72"><a href="#cb160-72" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb160-73"><a href="#cb160-73" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb160-74"><a href="#cb160-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-75"><a href="#cb160-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">|&gt;</span></span>
<span id="cb160-76"><a href="#cb160-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb160-77"><a href="#cb160-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb160-78"><a href="#cb160-78" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span> <span class="st">"Goat Incidence"</span>,</span>
<span id="cb160-79"><a href="#cb160-79" aria-hidden="true" tabindex="-1"></a>      term <span class="sc">==</span> <span class="st">"catt_incidence"</span> <span class="sc">~</span> <span class="st">"Cattle incidence"</span>,</span>
<span id="cb160-80"><a href="#cb160-80" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term) </span>
<span id="cb160-81"><a href="#cb160-81" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb160-82"><a href="#cb160-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> term</span>
<span id="cb160-83"><a href="#cb160-83" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>  </span>
<span id="cb160-84"><a href="#cb160-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="dv">6</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb160-85"><a href="#cb160-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb160-86"><a href="#cb160-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb160-87"><a href="#cb160-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_low =</span> <span class="fu">min</span>(estimate <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb160-88"><a href="#cb160-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_high =</span> <span class="fu">max</span>(estimate <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb160-89"><a href="#cb160-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb160-90"><a href="#cb160-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-91"><a href="#cb160-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mod_county)</span>
<span id="cb160-92"><a href="#cb160-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb160-93"><a href="#cb160-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-94"><a href="#cb160-94" aria-hidden="true" tabindex="-1"></a>county_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_2_2_complete<span class="sc">$</span>county)</span>
<span id="cb160-95"><a href="#cb160-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-96"><a href="#cb160-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store the models for each county</span></span>
<span id="cb160-97"><a href="#cb160-97" aria-hidden="true" tabindex="-1"></a>models_list_withouNA <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb160-98"><a href="#cb160-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-99"><a href="#cb160-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the data frame for each county</span></span>
<span id="cb160-100"><a href="#cb160-100" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag2_withoutNA <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">county =</span> <span class="fu">character</span>(), </span>
<span id="cb160-101"><a href="#cb160-101" aria-hidden="true" tabindex="-1"></a>                              <span class="at">variable =</span> <span class="fu">character</span>(),</span>
<span id="cb160-102"><a href="#cb160-102" aria-hidden="true" tabindex="-1"></a>                              <span class="at">estimate =</span> <span class="fu">numeric</span>(),</span>
<span id="cb160-103"><a href="#cb160-103" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb160-104"><a href="#cb160-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-105"><a href="#cb160-105" aria-hidden="true" tabindex="-1"></a><span class="co"># At lag 2</span></span>
<span id="cb160-106"><a href="#cb160-106" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (county_name <span class="cf">in</span> county_names) {</span>
<span id="cb160-107"><a href="#cb160-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Fitting model for"</span>, county_name))</span>
<span id="cb160-108"><a href="#cb160-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb160-109"><a href="#cb160-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-110"><a href="#cb160-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb160-111"><a href="#cb160-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb160-112"><a href="#cb160-112" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> <span class="fu">fit_county_model_complete</span>(county_name, df_2_2_complete, <span class="at">type =</span> <span class="st">"individual"</span>)</span>
<span id="cb160-113"><a href="#cb160-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb160-114"><a href="#cb160-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if model fitting was successful</span></span>
<span id="cb160-115"><a href="#cb160-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_county)) {</span>
<span id="cb160-116"><a href="#cb160-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients, round off, and add to the data frame</span></span>
<span id="cb160-117"><a href="#cb160-117" aria-hidden="true" tabindex="-1"></a>    coefficients_df_lag2_withoutNA <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coefficients_df_lag2_withoutNA, </span>
<span id="cb160-118"><a href="#cb160-118" aria-hidden="true" tabindex="-1"></a>                                 mod_county <span class="sc">%&gt;%</span> </span>
<span id="cb160-119"><a href="#cb160-119" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">mutate</span>(<span class="at">county =</span> county_name,</span>
<span id="cb160-120"><a href="#cb160-120" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>)))</span>
<span id="cb160-121"><a href="#cb160-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-122"><a href="#cb160-122" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for Baringo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.
Fitting model for Bomet

Using `date` as index variable.
Fitting model for Bungoma

Using `date` as index variable.
Fitting model for Busia

Using `date` as index variable.
Fitting model for Elgeyo Marakwet

Using `date` as index variable.
Fitting model for Embu

Using `date` as index variable.
Fitting model for Garissa

Using `date` as index variable.
Fitting model for Isiolo

Using `date` as index variable.
Fitting model for Kakamega

Using `date` as index variable.
Fitting model for Kericho

Using `date` as index variable.
Fitting model for Kilifi

Using `date` as index variable.
Fitting model for Kirinyaga

Using `date` as index variable.
Fitting model for Kisii

Using `date` as index variable.
Fitting model for Kitui

Using `date` as index variable.
Fitting model for Laikipia

Using `date` as index variable.
Fitting model for Machakos

Using `date` as index variable.
Fitting model for Makueni

Using `date` as index variable.
Fitting model for Mandera

Using `date` as index variable.
Fitting model for Marsabit

Using `date` as index variable.
Fitting model for Meru

Using `date` as index variable.
Fitting model for Migori

Using `date` as index variable.
Fitting model for Mombasa

Using `date` as index variable.
Fitting model for Murang'a

Using `date` as index variable.
Fitting model for Nakuru

Using `date` as index variable.
Fitting model for Nandi

Using `date` as index variable.
Fitting model for Narok

Using `date` as index variable.
Fitting model for Nyamira

Using `date` as index variable.
Fitting model for Nyeri

Using `date` as index variable.
Fitting model for Siaya

Using `date` as index variable.
Fitting model for Taita Taveta

Using `date` as index variable.
Fitting model for Tharaka Nithi

Using `date` as index variable.
Fitting model for Trans Nzoia

Using `date` as index variable.
Fitting model for Turkana

Using `date` as index variable.
Fitting model for Uasin Gishu

Using `date` as index variable.
Fitting model for Vihiga

Using `date` as index variable.
Fitting model for West Pokot

Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag2_withoutNA <span class="ot">&lt;-</span> coefficients_df_lag2_withoutNA <span class="sc">|&gt;</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>)))</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(coefficients_df_lag2_withoutNA, <span class="st">"individual_animal_incidence_per_county_lag2_withoutNA.csv"</span>)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="co"># At lag 3</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag3_withoutNA <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">county =</span> <span class="fu">character</span>(), </span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variable =</span> <span class="fu">character</span>(),</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">estimate =</span> <span class="fu">numeric</span>(),</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (county_name <span class="cf">in</span> county_names) {</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Fitting model for"</span>, county_name))</span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit the model</span></span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a>  mod_county <span class="ot">&lt;-</span> <span class="fu">fit_county_model_complete</span>(county_name, df_2_3_complete, <span class="at">type =</span> <span class="st">"individual"</span>)</span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-20"><a href="#cb163-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if model fitting was successful</span></span>
<span id="cb163-21"><a href="#cb163-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod_county)) {</span>
<span id="cb163-22"><a href="#cb163-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients, round off, and add to the data frame</span></span>
<span id="cb163-23"><a href="#cb163-23" aria-hidden="true" tabindex="-1"></a>    coefficients_df_lag3_withoutNA <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coefficients_df_lag3_withoutNA, </span>
<span id="cb163-24"><a href="#cb163-24" aria-hidden="true" tabindex="-1"></a>                                 mod_county <span class="sc">%&gt;%</span> </span>
<span id="cb163-25"><a href="#cb163-25" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">mutate</span>(<span class="at">county =</span> county_name,</span>
<span id="cb163-26"><a href="#cb163-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>)))</span>
<span id="cb163-27"><a href="#cb163-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-28"><a href="#cb163-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fitting model for Baringo
Skipping model for Baringo as all incidences are zero.
Fitting model for Bomet
Using `date` as index variable.Fitting model for Bungoma
Using `date` as index variable.Fitting model for Busia
Using `date` as index variable.Fitting model for Elgeyo Marakwet
Using `date` as index variable.Fitting model for Embu
Using `date` as index variable.Fitting model for Garissa
Using `date` as index variable.Fitting model for Isiolo
Using `date` as index variable.Fitting model for Kakamega
Using `date` as index variable.Fitting model for Kericho
Using `date` as index variable.Fitting model for Kilifi
Using `date` as index variable.Fitting model for Kirinyaga
Using `date` as index variable.Fitting model for Kisii
Using `date` as index variable.Fitting model for Kitui
Using `date` as index variable.Fitting model for Laikipia
Using `date` as index variable.Fitting model for Machakos
Using `date` as index variable.Fitting model for Makueni
Using `date` as index variable.Fitting model for Mandera
Using `date` as index variable.Fitting model for Marsabit
Using `date` as index variable.Fitting model for Meru
Using `date` as index variable.Fitting model for Migori
Using `date` as index variable.Fitting model for Mombasa
Using `date` as index variable.Fitting model for Murang'a
Using `date` as index variable.Fitting model for Nakuru
Using `date` as index variable.Fitting model for Nandi
Using `date` as index variable.Fitting model for Narok
Using `date` as index variable.Fitting model for Nyamira
Using `date` as index variable.Fitting model for Nyeri
Using `date` as index variable.Fitting model for Siaya
Using `date` as index variable.Fitting model for Taita Taveta
Using `date` as index variable.Fitting model for Tharaka Nithi
Using `date` as index variable.Fitting model for Trans Nzoia
Using `date` as index variable.Fitting model for Turkana
Using `date` as index variable.Fitting model for Uasin Gishu
Using `date` as index variable.Fitting model for Vihiga
Using `date` as index variable.Fitting model for West Pokot
Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>coefficients_df_lag3_withoutNA <span class="ot">&lt;-</span> coefficients_df_lag3_withoutNA <span class="sc">|&gt;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>)))</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(coefficients_df_lag3_withoutNA, <span class="st">"individual_animal_incidence_per_county_lag4_withoutNA.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note: All counties model (combined without NA-complete case) at lag 2 and 3 was omitted as it had no difference to combined with NA</p>
</section>
<section id="mixed-effect-models" class="level1">
<h1>Mixed Effect Models</h1>
<p>The section includes the mixed effect modelling. The mixed effect was done for both the incidence (as integers), cases and the proportion, and at lags 0 to 3.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing packages</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(pacman))</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">p_load</span>(</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>    tidyverse,</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    tseries,</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>    data.table,</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>    scales,</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>    zoo,</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>    forecast,</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>    sf,</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>    patchwork,</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>    grid,</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>    fable,</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>    patchwork,</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>    xts,</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>    feasts,</span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>    cowplot,</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>    broom,</span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>    kableExtra,</span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a>    readxl,</span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>    stringi,</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a>    stringr,</span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a>    rKenyaCensus,</span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a>    knitr,</span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a>    purrr,</span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a>    RColorBrewer,</span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a>    tscount,</span>
<span id="cb166-29"><a href="#cb166-29" aria-hidden="true" tabindex="-1"></a>    lme4</span>
<span id="cb166-30"><a href="#cb166-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb166-31"><a href="#cb166-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-32"><a href="#cb166-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-33"><a href="#cb166-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing data</span></span>
<span id="cb166-34"><a href="#cb166-34" aria-hidden="true" tabindex="-1"></a>individual <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"individual_incidence_cases.csv"</span>)</span>
<span id="cb166-35"><a href="#cb166-35" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"combined_incidence_cases.csv"</span>)</span>
<span id="cb166-36"><a href="#cb166-36" aria-hidden="true" tabindex="-1"></a>individual_county <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"df_tot_cases_spatial_month.csv"</span>)</span>
<span id="cb166-37"><a href="#cb166-37" aria-hidden="true" tabindex="-1"></a>combined_county <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"df_spatial_cum_month.csv"</span>)</span>
<span id="cb166-38"><a href="#cb166-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-39"><a href="#cb166-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-40"><a href="#cb166-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete</span></span>
<span id="cb166-41"><a href="#cb166-41" aria-hidden="true" tabindex="-1"></a>county_indivi_complete <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"df_1_complete.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb166-42"><a href="#cb166-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hum_cases =</span> <span class="fu">round</span>(hum_cases))</span>
<span id="cb166-43"><a href="#cb166-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-44"><a href="#cb166-44" aria-hidden="true" tabindex="-1"></a>county_comb_complete <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"df_cum_complete.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb166-45"><a href="#cb166-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hum_cases =</span> <span class="fu">round</span>(hum_cases))</span>
<span id="cb166-46"><a href="#cb166-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-47"><a href="#cb166-47" aria-hidden="true" tabindex="-1"></a>county_humanpop <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">'county_humanpop.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual: Incidence</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The cattle and goat incidence were calculated 10M per population</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>df_indivi_inci <span class="ot">&lt;-</span> county_indivi_complete <span class="sc">|&gt;</span> </span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(catt_incidence, goat_incidence), <span class="sc">~</span> <span class="fu">round</span>(.<span class="sc">*</span><span class="dv">10</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">human_incidence =</span> <span class="fu">round</span>(human_incidence <span class="sc">*</span> <span class="dv">10</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual: Proportion</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>df_indivi_inci_prop <span class="ot">&lt;-</span> county_indivi_complete <span class="sc">|&gt;</span> </span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(catt_incidence, goat_incidence), <span class="sc">~</span> .<span class="sc">*</span><span class="dv">10</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">human_incidence =</span> human_incidence<span class="sc">/</span><span class="fl">1e3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="st">"incidence"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))) <span class="sc">|&gt;</span> </span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(county_humanpop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"county"</span>, <span class="st">"date"</span>))</span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual: Cases</span></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>df_indivi_cases <span class="ot">&lt;-</span> county_indivi_complete <span class="sc">|&gt;</span> </span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, <span class="fu">contains</span>(<span class="st">"cases"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-23"><a href="#cb167-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined : Incidence</span></span>
<span id="cb167-24"><a href="#cb167-24" aria-hidden="true" tabindex="-1"></a>df_comb_inci <span class="ot">&lt;-</span> county_comb_complete <span class="sc">|&gt;</span> </span>
<span id="cb167-25"><a href="#cb167-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">human_incidence =</span> <span class="fu">round</span>(human_incidence<span class="sc">*</span><span class="dv">10</span>),</span>
<span id="cb167-26"><a href="#cb167-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_incidence =</span> <span class="fu">round</span>(animal_incidence<span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb167-27"><a href="#cb167-27" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb167-28"><a href="#cb167-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, animal_incidence, human_incidence) <span class="sc">|&gt;</span> </span>
<span id="cb167-29"><a href="#cb167-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span>
<span id="cb167-30"><a href="#cb167-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-31"><a href="#cb167-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-32"><a href="#cb167-32" aria-hidden="true" tabindex="-1"></a><span class="co"># combined: Proportion</span></span>
<span id="cb167-33"><a href="#cb167-33" aria-hidden="true" tabindex="-1"></a>df_comb_inci_prop <span class="ot">&lt;-</span> county_comb_complete <span class="sc">|&gt;</span> </span>
<span id="cb167-34"><a href="#cb167-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">human_incidence =</span> human_incidence<span class="sc">/</span><span class="fl">1e3</span>,</span>
<span id="cb167-35"><a href="#cb167-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_incidence =</span> animal_incidence<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb167-36"><a href="#cb167-36" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb167-37"><a href="#cb167-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, animal_incidence, human_incidence) <span class="sc">|&gt;</span> </span>
<span id="cb167-38"><a href="#cb167-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))<span class="sc">|&gt;</span> </span>
<span id="cb167-39"><a href="#cb167-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(county_humanpop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"county"</span>, <span class="st">"date"</span>))</span>
<span id="cb167-40"><a href="#cb167-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-41"><a href="#cb167-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined: Cases</span></span>
<span id="cb167-42"><a href="#cb167-42" aria-hidden="true" tabindex="-1"></a>df_comb_cases <span class="ot">&lt;-</span> county_comb_complete <span class="sc">|&gt;</span> </span>
<span id="cb167-43"><a href="#cb167-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, county, animal_cases, hum_cases) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual Incidence</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>indivi_models <span class="ot">&lt;-</span> <span class="cf">function</span>(df, type, max_lag, ...) {</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Type is either prop or incidence</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  result_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"prop"</span>) {</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (lag_value <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_lag) {</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>      df_lagged <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate_at</span>(</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">vars</span>(</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>            catt_incidence,</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>            goat_incidence</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> lag_value))</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span></span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">glmer</span>(</span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a>          human_incidence <span class="sc">~</span> catt_incidence <span class="sc">+</span> goat_incidence <span class="sc">+</span> </span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>               county),</span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> df_lagged,</span>
<span id="cb168-25"><a href="#cb168-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb168-26"><a href="#cb168-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">nAGQ =</span> <span class="dv">0</span>,</span>
<span id="cb168-27"><a href="#cb168-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> pop</span>
<span id="cb168-28"><a href="#cb168-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb168-29"><a href="#cb168-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb168-30"><a href="#cb168-30" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb168-31"><a href="#cb168-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb168-32"><a href="#cb168-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb168-33"><a href="#cb168-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb168-34"><a href="#cb168-34" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span> <span class="st">"Goat Incidence"</span>,</span>
<span id="cb168-35"><a href="#cb168-35" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"catt_incidence"</span> <span class="sc">~</span> <span class="st">"Cattle incidence"</span>,</span>
<span id="cb168-36"><a href="#cb168-36" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"sd__(Intercept)"</span> <span class="sc">~</span> <span class="st">"Sd - Random Intercept"</span>,</span>
<span id="cb168-37"><a href="#cb168-37" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term)</span>
<span id="cb168-38"><a href="#cb168-38" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-39"><a href="#cb168-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">effect =</span> <span class="fu">case_when</span>(</span>
<span id="cb168-40"><a href="#cb168-40" aria-hidden="true" tabindex="-1"></a>            effect <span class="sc">==</span> <span class="st">"ran_pars"</span> <span class="sc">~</span> <span class="st">"Random"</span>,</span>
<span id="cb168-41"><a href="#cb168-41" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> effect</span>
<span id="cb168-42"><a href="#cb168-42" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-43"><a href="#cb168-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">variable =</span> term</span>
<span id="cb168-44"><a href="#cb168-44" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span> </span>
<span id="cb168-45"><a href="#cb168-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span> <span class="ot">=</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb168-46"><a href="#cb168-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">odds =</span> <span class="fu">exp</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span>),</span>
<span id="cb168-47"><a href="#cb168-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">odds =</span> <span class="fu">ifelse</span>(effect <span class="sc">==</span> <span class="st">"Random"</span>, <span class="cn">NA</span>, odds)</span>
<span id="cb168-48"><a href="#cb168-48" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">|&gt;</span> </span>
<span id="cb168-49"><a href="#cb168-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">8</span>,<span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb168-50"><a href="#cb168-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb168-51"><a href="#cb168-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb168-52"><a href="#cb168-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_low =</span> <span class="fu">min</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span> <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb168-53"><a href="#cb168-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_high =</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span> <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb168-54"><a href="#cb168-54" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb168-55"><a href="#cb168-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">lag =</span> lag_value)</span>
<span id="cb168-56"><a href="#cb168-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb168-57"><a href="#cb168-57" aria-hidden="true" tabindex="-1"></a>      metrics <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">glance</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb168-58"><a href="#cb168-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(nobs, AIC, BIC)</span>
<span id="cb168-59"><a href="#cb168-59" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb168-60"><a href="#cb168-60" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_results, metrics) <span class="sc">|&gt;</span></span>
<span id="cb168-61"><a href="#cb168-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb168-62"><a href="#cb168-62" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb168-63"><a href="#cb168-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">log odds</span><span class="st">`</span>,</span>
<span id="cb168-64"><a href="#cb168-64" aria-hidden="true" tabindex="-1"></a>            odds,</span>
<span id="cb168-65"><a href="#cb168-65" aria-hidden="true" tabindex="-1"></a>            std.error,</span>
<span id="cb168-66"><a href="#cb168-66" aria-hidden="true" tabindex="-1"></a>            statistic,</span>
<span id="cb168-67"><a href="#cb168-67" aria-hidden="true" tabindex="-1"></a>            p.value,</span>
<span id="cb168-68"><a href="#cb168-68" aria-hidden="true" tabindex="-1"></a>            conf_low,</span>
<span id="cb168-69"><a href="#cb168-69" aria-hidden="true" tabindex="-1"></a>            conf_high,</span>
<span id="cb168-70"><a href="#cb168-70" aria-hidden="true" tabindex="-1"></a>            AIC,</span>
<span id="cb168-71"><a href="#cb168-71" aria-hidden="true" tabindex="-1"></a>            BIC</span>
<span id="cb168-72"><a href="#cb168-72" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-73"><a href="#cb168-73" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb168-74"><a href="#cb168-74" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">|&gt;</span></span>
<span id="cb168-75"><a href="#cb168-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">significance =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) </span>
<span id="cb168-76"><a href="#cb168-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Runnning model for lag"</span>, lag_value), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb168-77"><a href="#cb168-77" aria-hidden="true" tabindex="-1"></a>      result_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_df, mod_results)</span>
<span id="cb168-78"><a href="#cb168-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb168-79"><a href="#cb168-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb168-80"><a href="#cb168-80" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"inci"</span>) {</span>
<span id="cb168-81"><a href="#cb168-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (lag_value <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_lag) {</span>
<span id="cb168-82"><a href="#cb168-82" aria-hidden="true" tabindex="-1"></a>      df_lagged <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb168-83"><a href="#cb168-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb168-84"><a href="#cb168-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate_at</span>(</span>
<span id="cb168-85"><a href="#cb168-85" aria-hidden="true" tabindex="-1"></a>          <span class="fu">vars</span>(</span>
<span id="cb168-86"><a href="#cb168-86" aria-hidden="true" tabindex="-1"></a>            catt_incidence,</span>
<span id="cb168-87"><a href="#cb168-87" aria-hidden="true" tabindex="-1"></a>            goat_incidence</span>
<span id="cb168-88"><a href="#cb168-88" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-89"><a href="#cb168-89" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> lag_value))</span>
<span id="cb168-90"><a href="#cb168-90" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb168-91"><a href="#cb168-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb168-92"><a href="#cb168-92" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb168-93"><a href="#cb168-93" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb168-94"><a href="#cb168-94" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span></span>
<span id="cb168-95"><a href="#cb168-95" aria-hidden="true" tabindex="-1"></a>         <span class="fu">glmer.nb</span>(</span>
<span id="cb168-96"><a href="#cb168-96" aria-hidden="true" tabindex="-1"></a>          human_incidence <span class="sc">~</span> catt_incidence <span class="sc">+</span> goat_incidence <span class="sc">+</span></span>
<span id="cb168-97"><a href="#cb168-97" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb168-98"><a href="#cb168-98" aria-hidden="true" tabindex="-1"></a>               county),</span>
<span id="cb168-99"><a href="#cb168-99" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> df_lagged,</span>
<span id="cb168-100"><a href="#cb168-100" aria-hidden="true" tabindex="-1"></a>          <span class="at">nAGQ =</span> <span class="dv">0</span></span>
<span id="cb168-101"><a href="#cb168-101" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb168-102"><a href="#cb168-102" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb168-103"><a href="#cb168-103" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb168-104"><a href="#cb168-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb168-105"><a href="#cb168-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb168-106"><a href="#cb168-106" aria-hidden="true" tabindex="-1"></a>          <span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb168-107"><a href="#cb168-107" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"goat_incidence"</span> <span class="sc">~</span> <span class="st">"Goat Incidence"</span>,</span>
<span id="cb168-108"><a href="#cb168-108" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"catt_incidence"</span> <span class="sc">~</span> <span class="st">"Cattle incidence"</span>,</span>
<span id="cb168-109"><a href="#cb168-109" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"sd__(Intercept)"</span> <span class="sc">~</span> <span class="st">"Sd - Random Intercept"</span>,</span>
<span id="cb168-110"><a href="#cb168-110" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term)</span>
<span id="cb168-111"><a href="#cb168-111" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-112"><a href="#cb168-112" aria-hidden="true" tabindex="-1"></a>          <span class="at">effect =</span> <span class="fu">case_when</span>(</span>
<span id="cb168-113"><a href="#cb168-113" aria-hidden="true" tabindex="-1"></a>            effect <span class="sc">==</span> <span class="st">"ran_pars"</span> <span class="sc">~</span> <span class="st">"Random"</span>,</span>
<span id="cb168-114"><a href="#cb168-114" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> effect</span>
<span id="cb168-115"><a href="#cb168-115" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-116"><a href="#cb168-116" aria-hidden="true" tabindex="-1"></a>          <span class="at">variable =</span> term</span>
<span id="cb168-117"><a href="#cb168-117" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span> </span>
<span id="cb168-118"><a href="#cb168-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span> <span class="ot">=</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb168-119"><a href="#cb168-119" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">IRR =</span> <span class="fu">exp</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span>),</span>
<span id="cb168-120"><a href="#cb168-120" aria-hidden="true" tabindex="-1"></a>               <span class="at">IRR =</span> <span class="fu">ifelse</span>(effect <span class="sc">==</span> <span class="st">"Random"</span>, <span class="cn">NA</span>, IRR)</span>
<span id="cb168-121"><a href="#cb168-121" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">|&gt;</span> </span>
<span id="cb168-122"><a href="#cb168-122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">8</span>,<span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb168-123"><a href="#cb168-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb168-124"><a href="#cb168-124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb168-125"><a href="#cb168-125" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_low =</span> <span class="fu">min</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span> <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb168-126"><a href="#cb168-126" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_high =</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span> <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb168-127"><a href="#cb168-127" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb168-128"><a href="#cb168-128" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">lag =</span> lag_value)</span>
<span id="cb168-129"><a href="#cb168-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-130"><a href="#cb168-130" aria-hidden="true" tabindex="-1"></a>      metrics <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">glance</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb168-131"><a href="#cb168-131" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(nobs, AIC, BIC)</span>
<span id="cb168-132"><a href="#cb168-132" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb168-133"><a href="#cb168-133" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_results, metrics) <span class="sc">|&gt;</span></span>
<span id="cb168-134"><a href="#cb168-134" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb168-135"><a href="#cb168-135" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb168-136"><a href="#cb168-136" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">log IRR</span><span class="st">`</span>,</span>
<span id="cb168-137"><a href="#cb168-137" aria-hidden="true" tabindex="-1"></a>            IRR,</span>
<span id="cb168-138"><a href="#cb168-138" aria-hidden="true" tabindex="-1"></a>            std.error,</span>
<span id="cb168-139"><a href="#cb168-139" aria-hidden="true" tabindex="-1"></a>            statistic,</span>
<span id="cb168-140"><a href="#cb168-140" aria-hidden="true" tabindex="-1"></a>            p.value,</span>
<span id="cb168-141"><a href="#cb168-141" aria-hidden="true" tabindex="-1"></a>            conf_low,</span>
<span id="cb168-142"><a href="#cb168-142" aria-hidden="true" tabindex="-1"></a>            conf_high,</span>
<span id="cb168-143"><a href="#cb168-143" aria-hidden="true" tabindex="-1"></a>            AIC,</span>
<span id="cb168-144"><a href="#cb168-144" aria-hidden="true" tabindex="-1"></a>            BIC</span>
<span id="cb168-145"><a href="#cb168-145" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb168-146"><a href="#cb168-146" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">4</span>)</span>
<span id="cb168-147"><a href="#cb168-147" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">|&gt;</span></span>
<span id="cb168-148"><a href="#cb168-148" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">significance =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>))</span>
<span id="cb168-149"><a href="#cb168-149" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Runnning model for lag"</span>, lag_value), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb168-150"><a href="#cb168-150" aria-hidden="true" tabindex="-1"></a>      result_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_df, mod_results)</span>
<span id="cb168-151"><a href="#cb168-151" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb168-152"><a href="#cb168-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb168-153"><a href="#cb168-153" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb168-154"><a href="#cb168-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb168-155"><a href="#cb168-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result_df)</span>
<span id="cb168-156"><a href="#cb168-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-157"><a href="#cb168-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb168-158"><a href="#cb168-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-159"><a href="#cb168-159" aria-hidden="true" tabindex="-1"></a>df_indivi_model_inci <span class="ot">=</span> <span class="fu">indivi_models</span>(<span class="at">df =</span> df_indivi_inci, <span class="at">type =</span> <span class="st">"inci"</span>, <span class="at">max_lag =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 0 
Runnning model for lag 1 
Runnning model for lag 2 
Runnning model for lag 3 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>df_indivi_model_prop <span class="ot">=</span> <span class="fu">indivi_models</span>(<span class="at">df =</span> df_indivi_inci_prop, <span class="at">type =</span> <span class="st">"prop"</span>, <span class="at">max_lag =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 0 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 3 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_indivi_model_inci, <span class="st">"df_indivi_model_inci.csv"</span>)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined Cases</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>comb_models <span class="ot">&lt;-</span> <span class="cf">function</span>(df, type, max_lag, ...) {</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Type is either prop or incidence</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>  result_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"prop"</span>) {</span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (lag_value <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_lag) {</span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>      df_lagged <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate_at</span>(</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">vars</span>(</span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>            animal_incidence,</span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> lag_value))</span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span></span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">glmer</span>(</span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a>          human_incidence <span class="sc">~</span> animal_incidence <span class="sc">+</span> </span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a>               county),</span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> df_lagged,</span>
<span id="cb179-26"><a href="#cb179-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb179-27"><a href="#cb179-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">nAGQ =</span> <span class="dv">0</span>,</span>
<span id="cb179-28"><a href="#cb179-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> pop</span>
<span id="cb179-29"><a href="#cb179-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb179-30"><a href="#cb179-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-31"><a href="#cb179-31" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb179-32"><a href="#cb179-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb179-33"><a href="#cb179-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb179-34"><a href="#cb179-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb179-35"><a href="#cb179-35" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"animal_incidence"</span> <span class="sc">~</span> <span class="st">"Animal incidence"</span>,</span>
<span id="cb179-36"><a href="#cb179-36" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"sd__(Intercept)"</span> <span class="sc">~</span> <span class="st">"Sd - Random Intercept"</span>,</span>
<span id="cb179-37"><a href="#cb179-37" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term)</span>
<span id="cb179-38"><a href="#cb179-38" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-39"><a href="#cb179-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">effect =</span> <span class="fu">case_when</span>(</span>
<span id="cb179-40"><a href="#cb179-40" aria-hidden="true" tabindex="-1"></a>            effect <span class="sc">==</span> <span class="st">"ran_pars"</span> <span class="sc">~</span> <span class="st">"Random"</span>,</span>
<span id="cb179-41"><a href="#cb179-41" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> effect</span>
<span id="cb179-42"><a href="#cb179-42" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-43"><a href="#cb179-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">variable =</span> term</span>
<span id="cb179-44"><a href="#cb179-44" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span> </span>
<span id="cb179-45"><a href="#cb179-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span> <span class="ot">=</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb179-46"><a href="#cb179-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">odds =</span> <span class="fu">exp</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span>),</span>
<span id="cb179-47"><a href="#cb179-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">odds =</span> <span class="fu">ifelse</span>(effect <span class="sc">==</span> <span class="st">"Random"</span>, <span class="cn">NA</span>, odds)</span>
<span id="cb179-48"><a href="#cb179-48" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">|&gt;</span> </span>
<span id="cb179-49"><a href="#cb179-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">8</span>,<span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb179-50"><a href="#cb179-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb179-51"><a href="#cb179-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb179-52"><a href="#cb179-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_low =</span> <span class="fu">min</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span> <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb179-53"><a href="#cb179-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_high =</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">log odds</span><span class="st">`</span> <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb179-54"><a href="#cb179-54" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb179-55"><a href="#cb179-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">lag =</span> lag_value)</span>
<span id="cb179-56"><a href="#cb179-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-57"><a href="#cb179-57" aria-hidden="true" tabindex="-1"></a>      metrics <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">glance</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb179-58"><a href="#cb179-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(nobs, AIC, BIC)</span>
<span id="cb179-59"><a href="#cb179-59" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-60"><a href="#cb179-60" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_results, metrics) <span class="sc">|&gt;</span></span>
<span id="cb179-61"><a href="#cb179-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb179-62"><a href="#cb179-62" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb179-63"><a href="#cb179-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">log odds</span><span class="st">`</span>,</span>
<span id="cb179-64"><a href="#cb179-64" aria-hidden="true" tabindex="-1"></a>            odds,</span>
<span id="cb179-65"><a href="#cb179-65" aria-hidden="true" tabindex="-1"></a>            std.error,</span>
<span id="cb179-66"><a href="#cb179-66" aria-hidden="true" tabindex="-1"></a>            statistic,</span>
<span id="cb179-67"><a href="#cb179-67" aria-hidden="true" tabindex="-1"></a>            p.value,</span>
<span id="cb179-68"><a href="#cb179-68" aria-hidden="true" tabindex="-1"></a>            conf_low,</span>
<span id="cb179-69"><a href="#cb179-69" aria-hidden="true" tabindex="-1"></a>            conf_high,</span>
<span id="cb179-70"><a href="#cb179-70" aria-hidden="true" tabindex="-1"></a>            AIC,</span>
<span id="cb179-71"><a href="#cb179-71" aria-hidden="true" tabindex="-1"></a>            BIC</span>
<span id="cb179-72"><a href="#cb179-72" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-73"><a href="#cb179-73" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb179-74"><a href="#cb179-74" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">|&gt;</span></span>
<span id="cb179-75"><a href="#cb179-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">significance =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>)) </span>
<span id="cb179-76"><a href="#cb179-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Runnning model for lag"</span>, lag_value), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb179-77"><a href="#cb179-77" aria-hidden="true" tabindex="-1"></a>      result_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_df, mod_results)</span>
<span id="cb179-78"><a href="#cb179-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb179-79"><a href="#cb179-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb179-80"><a href="#cb179-80" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"inci"</span>) {</span>
<span id="cb179-81"><a href="#cb179-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (lag_value <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_lag) {</span>
<span id="cb179-82"><a href="#cb179-82" aria-hidden="true" tabindex="-1"></a>      df_lagged <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb179-83"><a href="#cb179-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb179-84"><a href="#cb179-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate_at</span>(</span>
<span id="cb179-85"><a href="#cb179-85" aria-hidden="true" tabindex="-1"></a>          <span class="fu">vars</span>(</span>
<span id="cb179-86"><a href="#cb179-86" aria-hidden="true" tabindex="-1"></a>         animal_incidence</span>
<span id="cb179-87"><a href="#cb179-87" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-88"><a href="#cb179-88" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="sc">~</span> <span class="fu">lag</span>(., <span class="at">n =</span> lag_value))</span>
<span id="cb179-89"><a href="#cb179-89" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb179-90"><a href="#cb179-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb179-91"><a href="#cb179-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb179-92"><a href="#cb179-92" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-93"><a href="#cb179-93" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span></span>
<span id="cb179-94"><a href="#cb179-94" aria-hidden="true" tabindex="-1"></a>         <span class="fu">glmer.nb</span>(</span>
<span id="cb179-95"><a href="#cb179-95" aria-hidden="true" tabindex="-1"></a>          human_incidence <span class="sc">~</span> animal_incidence <span class="sc">+</span></span>
<span id="cb179-96"><a href="#cb179-96" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb179-97"><a href="#cb179-97" aria-hidden="true" tabindex="-1"></a>               county),</span>
<span id="cb179-98"><a href="#cb179-98" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> df_lagged,</span>
<span id="cb179-99"><a href="#cb179-99" aria-hidden="true" tabindex="-1"></a>          <span class="at">nAGQ =</span> <span class="dv">0</span></span>
<span id="cb179-100"><a href="#cb179-100" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb179-101"><a href="#cb179-101" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-102"><a href="#cb179-102" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">tidy</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb179-103"><a href="#cb179-103" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb179-104"><a href="#cb179-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb179-105"><a href="#cb179-105" aria-hidden="true" tabindex="-1"></a>          <span class="at">term =</span> <span class="fu">case_when</span>(</span>
<span id="cb179-106"><a href="#cb179-106" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"animal_incidence"</span> <span class="sc">~</span> <span class="st">"Animal incidence"</span>,</span>
<span id="cb179-107"><a href="#cb179-107" aria-hidden="true" tabindex="-1"></a>            term <span class="sc">==</span> <span class="st">"sd__(Intercept)"</span> <span class="sc">~</span> <span class="st">"Sd - Random Intercept"</span>,</span>
<span id="cb179-108"><a href="#cb179-108" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(term)</span>
<span id="cb179-109"><a href="#cb179-109" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-110"><a href="#cb179-110" aria-hidden="true" tabindex="-1"></a>          <span class="at">effect =</span> <span class="fu">case_when</span>(</span>
<span id="cb179-111"><a href="#cb179-111" aria-hidden="true" tabindex="-1"></a>            effect <span class="sc">==</span> <span class="st">"ran_pars"</span> <span class="sc">~</span> <span class="st">"Random"</span>,</span>
<span id="cb179-112"><a href="#cb179-112" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> effect</span>
<span id="cb179-113"><a href="#cb179-113" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-114"><a href="#cb179-114" aria-hidden="true" tabindex="-1"></a>          <span class="at">variable =</span> term</span>
<span id="cb179-115"><a href="#cb179-115" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span> </span>
<span id="cb179-116"><a href="#cb179-116" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span> <span class="ot">=</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb179-117"><a href="#cb179-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">IRR =</span> <span class="fu">exp</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span>),</span>
<span id="cb179-118"><a href="#cb179-118" aria-hidden="true" tabindex="-1"></a>               <span class="at">IRR =</span> <span class="fu">ifelse</span>(effect <span class="sc">==</span> <span class="st">"Random"</span>, <span class="cn">NA</span>, IRR)</span>
<span id="cb179-119"><a href="#cb179-119" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">|&gt;</span> </span>
<span id="cb179-120"><a href="#cb179-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="dv">1</span>, <span class="dv">8</span>,<span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb179-121"><a href="#cb179-121" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb179-122"><a href="#cb179-122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb179-123"><a href="#cb179-123" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_low =</span> <span class="fu">min</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span> <span class="sc">-</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>),</span>
<span id="cb179-124"><a href="#cb179-124" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf_high =</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">log IRR</span><span class="st">`</span> <span class="sc">+</span> std.error <span class="sc">*</span> <span class="fl">1.645</span>)</span>
<span id="cb179-125"><a href="#cb179-125" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb179-126"><a href="#cb179-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">lag =</span> lag_value)</span>
<span id="cb179-127"><a href="#cb179-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-128"><a href="#cb179-128" aria-hidden="true" tabindex="-1"></a>      metrics <span class="ot">&lt;-</span> broom.mixed<span class="sc">::</span><span class="fu">glance</span>(mod) <span class="sc">%&gt;%</span></span>
<span id="cb179-129"><a href="#cb179-129" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(nobs, AIC, BIC)</span>
<span id="cb179-130"><a href="#cb179-130" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb179-131"><a href="#cb179-131" aria-hidden="true" tabindex="-1"></a>      mod_results <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_results, metrics) <span class="sc">|&gt;</span></span>
<span id="cb179-132"><a href="#cb179-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb179-133"><a href="#cb179-133" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb179-134"><a href="#cb179-134" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">log IRR</span><span class="st">`</span>,</span>
<span id="cb179-135"><a href="#cb179-135" aria-hidden="true" tabindex="-1"></a>            IRR,</span>
<span id="cb179-136"><a href="#cb179-136" aria-hidden="true" tabindex="-1"></a>            std.error,</span>
<span id="cb179-137"><a href="#cb179-137" aria-hidden="true" tabindex="-1"></a>            statistic,</span>
<span id="cb179-138"><a href="#cb179-138" aria-hidden="true" tabindex="-1"></a>            p.value,</span>
<span id="cb179-139"><a href="#cb179-139" aria-hidden="true" tabindex="-1"></a>            conf_low,</span>
<span id="cb179-140"><a href="#cb179-140" aria-hidden="true" tabindex="-1"></a>            conf_high,</span>
<span id="cb179-141"><a href="#cb179-141" aria-hidden="true" tabindex="-1"></a>            AIC,</span>
<span id="cb179-142"><a href="#cb179-142" aria-hidden="true" tabindex="-1"></a>            BIC</span>
<span id="cb179-143"><a href="#cb179-143" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb179-144"><a href="#cb179-144" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">4</span>)</span>
<span id="cb179-145"><a href="#cb179-145" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">|&gt;</span></span>
<span id="cb179-146"><a href="#cb179-146" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">significance =</span> <span class="fu">ifelse</span>(conf_low <span class="sc">*</span> conf_high <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Significant"</span>, <span class="st">"Not Significant"</span>))</span>
<span id="cb179-147"><a href="#cb179-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Runnning model for lag"</span>, lag_value), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb179-148"><a href="#cb179-148" aria-hidden="true" tabindex="-1"></a>      result_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(result_df, mod_results)</span>
<span id="cb179-149"><a href="#cb179-149" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb179-150"><a href="#cb179-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb179-151"><a href="#cb179-151" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-152"><a href="#cb179-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-153"><a href="#cb179-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result_df)</span>
<span id="cb179-154"><a href="#cb179-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-155"><a href="#cb179-155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-156"><a href="#cb179-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-157"><a href="#cb179-157" aria-hidden="true" tabindex="-1"></a>df_combined_model_inci <span class="ot">=</span> <span class="fu">comb_models</span>(<span class="at">df =</span> df_comb_inci, <span class="at">type =</span> <span class="st">"inci"</span>, <span class="at">max_lag =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 0 
Runnning model for lag 1 
Runnning model for lag 2 
Runnning model for lag 3 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>df_combined_model_prop <span class="ot">=</span> <span class="fu">comb_models</span>(<span class="at">df =</span> df_comb_inci_prop, <span class="at">type =</span> <span class="st">"prop"</span>, <span class="at">max_lag =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 0 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 1 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize, rho): non-integer #successes in a binomial
glm!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Runnning model for lag 3 </code></pre>
</div>
</div>
</section>
<section id="time-series-analysis" class="level1">
<h1>Time Series Analysis</h1>
<p>The following section contains the codes for time series analysis. Data was imported as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'clean_tseries_data.R'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I18 / R18C9: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in L18 / R18C12: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I19 / R19C9: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in L19 / R19C12: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I85 / R85C9: got a date</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 282 Columns: 3
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(2): County, species dbl (1): species_num
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.
`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.
• `year` -&gt; `year...10`
• `year` -&gt; `year...13`</code></pre>
</div>
</div>
<p>Then we test for stationarity as follows;<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing for stationary ---------------------------------------------------------------------------</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for human incidence</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(df_complete1<span class="sc">$</span>human_incidence) <span class="co"># Not stationary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  df_complete1$human_incidence
Dickey-Fuller = -1.8568, Lag order = 4, p-value = 0.6361
alternative hypothesis: stationary</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for animal incidence</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(df_complete1<span class="sc">$</span>animal_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in adf.test(df_complete1$animal_incidence): p-value smaller than
printed p-value</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  df_complete1$animal_incidence
Dickey-Fuller = -4.0428, Lag order = 4, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p><br>
Lag 3 had the highest correlation so we lagged the time series at lag 3.<br>
<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lagging ------------------------------------------------------------</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>df2<span class="fl">.1</span> <span class="ot">&lt;-</span> df_complete1 <span class="sc">|&gt;</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_incidence =</span> <span class="fu">lag</span>(animal_incidence, <span class="dv">3</span>)</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(date, <span class="at">.keep_all =</span> T)</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(df2<span class="fl">.1</span><span class="sc">$</span>human_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  df2.1$human_incidence
Dickey-Fuller = -2.1678, Lag order = 4, p-value = 0.5069
alternative hypothesis: stationary</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>df_xts1 <span class="ot">&lt;-</span> <span class="fu">as.xts</span>(<span class="at">x =</span> <span class="fu">cbind</span>(df2<span class="fl">.1</span><span class="sc">$</span>human_incidence, df2<span class="fl">.1</span><span class="sc">$</span>animal_incidence), <span class="at">order.by =</span> df2<span class="fl">.1</span><span class="sc">$</span>date) <span class="sc">|&gt;</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"human_incidence"</span>, <span class="st">"animal_incidence"</span>))</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df_xts1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for train and testing -------------------------------------------------------------</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>df_xts <span class="ot">&lt;-</span> <span class="fu">window</span>(df_xts1, <span class="at">start =</span><span class="st">'2014-04-01'</span>, <span class="at">end =</span> <span class="st">'2022-12-01'</span>)</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>forecast.df <span class="ot">&lt;-</span> <span class="fu">window</span>(df_xts1, <span class="at">start =</span><span class="st">'2023-01-01'</span>, <span class="at">end =</span> <span class="st">'2023-12-01'</span>)</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df2<span class="fl">.1</span> <span class="sc">|&gt;</span> </span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">'2023-01-01'</span>))</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Our training and testing data reaches 2022-12-01</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="testing-for-several-aspects-of-the-time-series" class="level2">
<h2 class="anchored" data-anchor-id="testing-for-several-aspects-of-the-time-series">Testing for several aspects of the time series</h2>
<section id="correlation-of-human-incidence-with-its-past-values" class="level3">
<h3 class="anchored" data-anchor-id="correlation-of-human-incidence-with-its-past-values">1. Correlation of human incidence with it’s past values</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between human incidence and the previous lags</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">=</span> df_xts <span class="sc">|&gt;</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">row.names =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> zoo<span class="sc">::</span><span class="fu">index</span>(df_xts) <span class="sc">|&gt;</span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>           zoo<span class="sc">::</span><span class="fu">as.yearmon</span>() <span class="sc">|&gt;</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>dd <span class="sc">|&gt;</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(human_incidence, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lag 1 seems to have a strong correlation with the current value of human incidence</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="decomposing-the-time-series" class="level3">
<h3 class="anchored" data-anchor-id="decomposing-the-time-series">3. Decomposing the time series</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>dcmp <span class="ot">&lt;-</span> dd <span class="sc">|&gt;</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(human_incidence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below is the trend and the time series</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The trend</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(<span class="at">y =</span> human_incidence, <span class="at">colour =</span> <span class="st">"Human Incidence"</span>)) <span class="sc">+</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(<span class="at">y =</span> trend, <span class="at">color =</span> <span class="st">'Trend'</span>)) <span class="sc">+</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Incidence (human cases per 1000 pop)"</span>,</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Human Brucellois incidence"</span>) <span class="sc">+</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>, <span class="at">hjust =</span> .<span class="dv">5</span>),</span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">'bottom'</span></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Human Incidence"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"Trend"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>)) <span class="sc">+</span></span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">'Series:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using the `size` aesthetic in this geom was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` in the `default_aes` field and elsewhere instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The time series seasonality</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seasonality</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(<span class="at">y =</span> human_incidence, <span class="at">colour =</span> <span class="st">"Human Incidence"</span>)) <span class="sc">+</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(<span class="at">y =</span> season_year, <span class="at">color =</span> <span class="st">'Season-year'</span>)) <span class="sc">+</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Incidence (human cases per 1000 pop)"</span>,</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Human Brucellois incidence"</span>) <span class="sc">+</span></span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>, <span class="at">hjust =</span> .<span class="dv">5</span>),</span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">'bottom'</span></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Human Incidence"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"Season-year"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>)) <span class="sc">+</span></span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">'Series:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>All of them together</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All of them together</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Plot without seasonality and trend</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The plot without seasonality and trend</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_xspline(aes(y = human_incidence, colour = "Human Incidence")) +</span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(<span class="at">y =</span> season_adjust <span class="sc">-</span> trend, <span class="at">color =</span> <span class="st">'Human Incidence without the seasonality'</span>)) <span class="sc">+</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Incidence (human cases per 1000 pop)"</span>,</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Human Brucellois incidence"</span>) <span class="sc">+</span></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">'black'</span>, <span class="at">hjust =</span> .<span class="dv">5</span>),</span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">'bottom'</span></span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Human Incidence"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"Human Incidence without the seasonality"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>)) <span class="sc">+</span></span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">'Series:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="train-and-testing-data" class="level2">
<h2 class="anchored" data-anchor-id="train-and-testing-data">Train and testing data</h2>
<p>We split our data into training and testing (80%, 20%) respectively as follows:<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting ------------------------------------------------------------------------------</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="co"># train &lt;- window(ts_diff, start = as.Date("2014-04-01"), end = "2021-12-01")</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- window(df_xts, start = as.Date("2022-01-01"), end = as.Date("2022-12-01"))</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We will take 70% for training, 30% for validation.</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df_xts) <span class="co"># our data has 105 rows, thus 70% of this is 73 rows for training and 32 for testing.,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 105</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0% is upto 2021-03-01 and then the rest for testing</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>nrow_70 <span class="ot">&lt;-</span> <span class="fu">floor</span>(.<span class="dv">7</span> <span class="sc">*</span> <span class="fu">nrow</span>(df_xts))</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> df_xts[<span class="dv">1</span><span class="sc">:</span>nrow_70,]</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df_xts[(nrow_70 <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(df_xts),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The acf and pacf plot were as follows;<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF and PACF plots ---------------------------------------------------------------------</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(train<span class="sc">$</span>human_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; shows both trend and seasonality.</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The slow decrease in the ACF as the lags increase is due to the trend, while the “scalloped” shape</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; is due to the seasonality. Time series that show no autocorrelation are called white noise. </span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(train<span class="sc">$</span>human_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="training-the-models" class="level2">
<h2 class="anchored" data-anchor-id="training-the-models">Training the Models</h2>
<section id="model-without-the-covariate" class="level3">
<h3 class="anchored" data-anchor-id="model-without-the-covariate">1. Model without the covariate</h3>
<p>The model without covariate was trained as follows;<br>
<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>model_sarima <span class="ot">&lt;-</span> train <span class="sc">|&gt;</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row.names</span>(.) <span class="sc">|&gt;</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>           zoo<span class="sc">::</span><span class="fu">as.yearmon</span>() <span class="sc">|&gt;</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ARIMA</span>(human_incidence,</span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">ic =</span> <span class="st">"aic"</span>,</span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepwise =</span> T</span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: ARIMA(0,1,0)(2,0,0)[12] 

Coefficients:
        sar1    sar2
      0.2934  0.3118
s.e.  0.1123  0.1275

sigma^2 estimated as 0.01306:  log likelihood=52.59
AIC=-99.19   AICc=-98.84   BIC=-92.36</code></pre>
</div>
</div>
<p>We then forecasted and extracted values for the forecasted as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>original_data <span class="ot">&lt;-</span> df_xts <span class="sc">|&gt;</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row.names</span>(.) <span class="sc">|&gt;</span> <span class="fu">ymd</span>())</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>fitted <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_sarima) <span class="sc">|&gt;</span> </span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="at">fitted =</span>.fitted, <span class="at">residuals =</span> .resid) <span class="sc">|&gt;</span> </span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(date) </span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>         ) </span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>CI <span class="ot">&lt;-</span>  <span class="fu">hilo</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(model_sarima, <span class="at">h =</span> <span class="fu">nrow</span>(test))) <span class="sc">|&gt;</span> </span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>CI80 <span class="ot">&lt;-</span> CI<span class="sc">$</span><span class="st">`</span><span class="at">80%</span><span class="st">`</span> <span class="sc">|&gt;</span> </span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">FUN =</span> first) <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>V3) <span class="sc">|&gt;</span> </span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Lo80"</span>, <span class="st">"Hi80"</span>))</span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a>CI95 <span class="ot">&lt;-</span> CI<span class="sc">$</span><span class="st">`</span><span class="at">95%</span><span class="st">`</span> <span class="sc">|&gt;</span> </span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">FUN =</span> first) <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb224-26"><a href="#cb224-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>V3) <span class="sc">|&gt;</span> </span>
<span id="cb224-27"><a href="#cb224-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Lo95"</span>, <span class="st">"Hi95"</span>))</span>
<span id="cb224-28"><a href="#cb224-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-29"><a href="#cb224-29" aria-hidden="true" tabindex="-1"></a>forecast_data_human_sarima <span class="ot">&lt;-</span></span>
<span id="cb224-30"><a href="#cb224-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb224-31"><a href="#cb224-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(test)) <span class="sc">|&gt;</span></span>
<span id="cb224-32"><a href="#cb224-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ymd</span>(),</span>
<span id="cb224-33"><a href="#cb224-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">PointForecast =</span> CI<span class="sc">$</span>.mean,</span>
<span id="cb224-34"><a href="#cb224-34" aria-hidden="true" tabindex="-1"></a>    CI80,</span>
<span id="cb224-35"><a href="#cb224-35" aria-hidden="true" tabindex="-1"></a>    CI95</span>
<span id="cb224-36"><a href="#cb224-36" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The above data gave the following plot</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>forecast_plot_human_sarima <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(original_data) <span class="sc">+</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> forecast_data_human_sarima, <span class="fu">aes</span>(date, <span class="at">ymin =</span> Lo95, <span class="at">ymax =</span> Hi95, <span class="at">fill =</span> <span class="st">"95% CI"</span>), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="at">data =</span> fitted, <span class="fu">aes</span>(date, <span class="at">y =</span> fitted, <span class="at">color =</span> <span class="st">"fitted"</span>)) <span class="sc">+</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> forecast_data_human_sarima, <span class="fu">aes</span>(date, <span class="at">ymin =</span> Lo80, <span class="at">ymax =</span> Hi80, <span class="at">fill =</span> <span class="st">"80% CI"</span>), <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="at">data =</span> forecast_data_human_sarima, <span class="fu">aes</span>(date, PointForecast, <span class="at">colour =</span> <span class="st">"Predicted human incidence"</span>)) <span class="sc">+</span></span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(date, human_incidence, <span class="at">color =</span> <span class="st">"Actual human incidence"</span>)) <span class="sc">+</span></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> .<span class="dv">5</span>)</span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Human Incidence"</span>) <span class="sc">+</span></span>
<span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Predicted human incidence"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Actual human incidence"</span> <span class="ot">=</span> <span class="st">"black"</span>,</span>
<span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">'fitted'</span> <span class="ot">=</span> <span class="st">'blue'</span></span>
<span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb225-22"><a href="#cb225-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb225-23"><a href="#cb225-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb225-24"><a href="#cb225-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb225-25"><a href="#cb225-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"95% CI"</span> <span class="ot">=</span> <span class="st">"blue"</span>,</span>
<span id="cb225-26"><a href="#cb225-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"80% CI"</span> <span class="ot">=</span> <span class="st">"blue"</span></span>
<span id="cb225-27"><a href="#cb225-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb225-28"><a href="#cb225-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb225-29"><a href="#cb225-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">1</span>))</span>
<span id="cb225-30"><a href="#cb225-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb225-31"><a href="#cb225-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb225-32"><a href="#cb225-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>)</span>
<span id="cb225-33"><a href="#cb225-33" aria-hidden="true" tabindex="-1"></a><span class="co">#plotly::ggplotly( forecast_plot_human_sarima)</span></span>
<span id="cb225-34"><a href="#cb225-34" aria-hidden="true" tabindex="-1"></a>forecast_plot_human_sarima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model metrics were calculated as follows:<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>test_acc <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">rownames</span>(.) <span class="sc">|&gt;</span> <span class="fu">ymd</span>() <span class="sc">|&gt;</span> <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>animal_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>model_sarima_accuracy <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(model_sarima, <span class="at">h =</span> <span class="fu">nrow</span>(test)), test_acc,</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">measures =</span> <span class="fu">list</span>(</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>    point_accuracy_measures,</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>    interval_accuracy_measures,</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>    distribution_accuracy_measures</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>model_sarima_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 15
  .model   .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1 winkler pinball
  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 "ARIMA(… Test  0.126 0.162 0.134  11.6  12.6   NaN   NaN 0.261    1.96  0.0694
# ℹ 3 more variables: scaled_pinball &lt;dbl&gt;, percentile &lt;dbl&gt;, CRPS &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="model-with-the-covariate" class="level3">
<h3 class="anchored" data-anchor-id="model-with-the-covariate">2. Model with the covariate</h3>
<p>The model without covariate was trained as follows;<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>model_sarima_covariates <span class="ot">&lt;-</span> train <span class="sc">|&gt;</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row.names</span>(.) <span class="sc">|&gt;</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>           zoo<span class="sc">::</span><span class="fu">as.yearmon</span>() <span class="sc">|&gt;</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>    human_incidence <span class="sc">~</span> animal_incidence,</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ic =</span> <span class="st">"aic"</span>,</span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepwise =</span> T</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: LM w/ ARIMA(0,1,0)(2,0,0)[12] errors 

Coefficients:
        sar1    sar2  animal_incidence
      0.2826  0.3125            0.0101
s.e.  0.1152  0.1280            0.0170

sigma^2 estimated as 0.01322:  log likelihood=52.77
AIC=-97.54   AICc=-96.95   BIC=-88.44</code></pre>
</div>
</div>
<p>We then forecasted and extracted values for the forecasted as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>fitted_covariate <span class="ot">&lt;-</span> <span class="fu">augment</span>(model_sarima_covariates) <span class="sc">|&gt;</span> </span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="at">fitted =</span>.fitted, <span class="at">residuals =</span> .resid) <span class="sc">|&gt;</span> </span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(date) </span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>test_tsibble <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">rownames</span>(.) <span class="sc">|&gt;</span> <span class="fu">ymd</span>() <span class="sc">|&gt;</span> <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>human_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>CI_covariate <span class="ot">&lt;-</span> model_sarima_covariates <span class="sc">|&gt;</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> test_tsibble) <span class="sc">|&gt;</span> </span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hilo</span>()</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>CI_covariate80 <span class="ot">&lt;-</span> CI_covariate<span class="sc">$</span><span class="st">`</span><span class="at">80%</span><span class="st">`</span> <span class="sc">|&gt;</span> </span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">FUN =</span> first) <span class="sc">|&gt;</span> </span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>V3) <span class="sc">|&gt;</span> </span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Lo80"</span>, <span class="st">"Hi80"</span>))</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>CI_covariate95 <span class="ot">&lt;-</span> CI_covariate<span class="sc">$</span><span class="st">`</span><span class="at">95%</span><span class="st">`</span> <span class="sc">|&gt;</span> </span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">FUN =</span> first) <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>V3) <span class="sc">|&gt;</span> </span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Lo95"</span>, <span class="st">"Hi95"</span>))</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a>forecast_data_covariate_sarima <span class="ot">&lt;-</span></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(test)) <span class="sc">|&gt;</span></span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ymd</span>(),</span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">PointForecast =</span> CI_covariate<span class="sc">$</span>.mean,</span>
<span id="cb235-26"><a href="#cb235-26" aria-hidden="true" tabindex="-1"></a>    CI_covariate80,</span>
<span id="cb235-27"><a href="#cb235-27" aria-hidden="true" tabindex="-1"></a>    CI_covariate95</span>
<span id="cb235-28"><a href="#cb235-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The above data gave the following plot</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>forecast_plot_covariate_sarima <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(original_data) <span class="sc">+</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> forecast_data_covariate_sarima, <span class="fu">aes</span>(date, <span class="at">ymin =</span> Lo95, <span class="at">ymax =</span> Hi95, <span class="at">fill =</span> <span class="st">"95% CI"</span>), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> forecast_data_covariate_sarima, <span class="fu">aes</span>(date, <span class="at">ymin =</span> Lo80, <span class="at">ymax =</span> Hi80, <span class="at">fill =</span> <span class="st">"80% CI"</span>), <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="at">data =</span> fitted_covariate, <span class="fu">aes</span>(date, <span class="at">y =</span> fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)) <span class="sc">+</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="at">data =</span> forecast_data_covariate_sarima, <span class="fu">aes</span>(date, PointForecast, <span class="at">colour =</span> <span class="st">"Predicted human incidence"</span>)) <span class="sc">+</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(date, human_incidence, <span class="at">color =</span> <span class="st">"Actual human incidence"</span>)) <span class="sc">+</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> .<span class="dv">5</span>)</span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Human Incidence"</span>) <span class="sc">+</span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Predicted human incidence"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Actual human incidence"</span> <span class="ot">=</span> <span class="st">"black"</span>,</span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Fitted'</span> <span class="ot">=</span> <span class="st">'blue'</span></span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"95% CI"</span> <span class="ot">=</span> <span class="st">"blue"</span>,</span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"80% CI"</span> <span class="ot">=</span> <span class="st">"blue"</span></span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">1</span>))</span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>)</span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>forecast_plot_covariate_sarima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model metrics were calculated as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>model_sarima_covariates_coefficients <span class="ot">&lt;-</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(model_sarima_covariates) <span class="sc">|&gt;</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">%&gt;%</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) </span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>test_acc2 <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span></span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">rownames</span>(.) <span class="sc">|&gt;</span> <span class="fu">ymd</span>() <span class="sc">|&gt;</span> <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span></span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>animal_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>model_sarima_covariate_accuracy <span class="ot">&lt;-</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>    model_sarima_covariates <span class="sc">|&gt;</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">forecast</span>(<span class="at">new_data =</span> test_tsibble) ,</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>    test_acc,</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">measures =</span> <span class="fu">list</span>(</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>      point_accuracy_measures,</span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>      interval_accuracy_measures,</span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>      distribution_accuracy_measures</span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a>model_sarima_covariate_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 15
  .model   .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1 winkler pinball
  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 "ARIMA(… Test  0.122 0.159 0.131  11.2  12.3   NaN   NaN 0.277    1.96  0.0700
# ℹ 3 more variables: scaled_pinball &lt;dbl&gt;, percentile &lt;dbl&gt;, CRPS &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="comparison-of-the-model-with-and-without-a-covariate" class="level3">
<h3 class="anchored" data-anchor-id="comparison-of-the-model-with-and-without-a-covariate">3. Comparison of the Model with and Without a covariate</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>model_sarima_accuracy2 <span class="ot">&lt;-</span> model_sarima_accuracy <span class="sc">|&gt;</span> </span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Model without Covariate"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.model, <span class="sc">-</span>.type) <span class="sc">|&gt;</span> </span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, RMSE, MAE, MAPE)</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>model_sarima_covariate_accuracy2 <span class="ot">&lt;-</span> model_sarima_covariate_accuracy <span class="sc">|&gt;</span> </span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Model with Covariate"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.model, <span class="sc">-</span>.type) <span class="sc">|&gt;</span> </span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, RMSE, MAE, MAPE)</span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model_sarima_accuracy2, model_sarima_covariate_accuracy2)</span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(metrics_df, <span class="st">"metrics_df.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>kableExtra<span class="sc">::</span><span class="fu">kable</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">MAE</th>
<th style="text-align: right;">MAPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model without Covariate</td>
<td style="text-align: right;">0.1615255</td>
<td style="text-align: right;">0.1342892</td>
<td style="text-align: right;">12.57971</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model with Covariate</td>
<td style="text-align: right;">0.1587211</td>
<td style="text-align: right;">0.1314678</td>
<td style="text-align: right;">12.27924</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(metrics_df, <span class="st">"metrics_df_70_30.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; We have saved the metrics df for several training set 70-30, 75-25, 80-20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The model with the covariate was better, based on the RMSE, MAE and MAPE. Thus, we used this to forecast the values for the year 2023,</p>
</section>
</section>
<section id="full-model-for-forecasting-2023-data" class="level2">
<h2 class="anchored" data-anchor-id="full-model-for-forecasting-2023-data">Full model for forecasting 2023 data</h2>
<p>we fit a time series data with animal incidence as the covariate with data from 2014 to 2022 and then use it to forecast 2023 human brucellosis incidence. The model was fitted as follows;<br>
<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series so that we can be able to forecast 2023.</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">&lt;-</span> df_xts <span class="sc">|&gt;</span> </span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row.names</span>(.) <span class="sc">|&gt;</span></span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>           zoo<span class="sc">::</span><span class="fu">as.yearmon</span>() <span class="sc">|&gt;</span></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">ARIMA</span>(</span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>    human_incidence <span class="sc">~</span> animal_incidence,</span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ic =</span> <span class="st">"aic"</span>,</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepwise =</span> T</span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: human_incidence 
Model: LM w/ ARIMA(1,1,1)(1,0,2)[12] errors 

Coefficients:
         ar1      ma1    sar1     sma1    sma2  animal_incidence
      0.5277  -0.7260  0.8624  -0.7944  0.1593            0.0188
s.e.  0.1941   0.1501  0.1309   0.1873  0.1259            0.0166

sigma^2 estimated as 0.01272:  log likelihood=80.16
AIC=-146.32   AICc=-145.15   BIC=-127.81</code></pre>
</div>
</div>
<p>Then, the forecasted data is curated as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>fitted_full <span class="ot">&lt;-</span> <span class="fu">augment</span>(full.model) <span class="sc">|&gt;</span> </span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="at">fitted =</span>.fitted, <span class="at">residuals =</span> .resid) <span class="sc">|&gt;</span> </span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(date) </span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>original_data2 <span class="ot">&lt;-</span>   df_xts <span class="sc">|&gt;</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(forecast.df) <span class="sc">|&gt;</span> </span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">row.names</span>(.) <span class="sc">|&gt;</span> <span class="fu">ymd</span>())</span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>test_tsibble <span class="ot">&lt;-</span> forecast.df <span class="sc">|&gt;</span> </span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">rownames</span>(.) <span class="sc">|&gt;</span> <span class="fu">ymd</span>() <span class="sc">|&gt;</span> <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>human_incidence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>CI_full <span class="ot">&lt;-</span> full.model <span class="sc">|&gt;</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> test_tsibble) <span class="sc">|&gt;</span> </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hilo</span>()</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>CI_full80 <span class="ot">&lt;-</span> CI_full<span class="sc">$</span><span class="st">`</span><span class="at">80%</span><span class="st">`</span> <span class="sc">|&gt;</span> </span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">FUN =</span> first) <span class="sc">|&gt;</span> </span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>V3) <span class="sc">|&gt;</span> </span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Lo80"</span>, <span class="st">"Hi80"</span>))</span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-13"><a href="#cb248-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-14"><a href="#cb248-14" aria-hidden="true" tabindex="-1"></a>CI_full95 <span class="ot">&lt;-</span> CI_full<span class="sc">$</span><span class="st">`</span><span class="at">95%</span><span class="st">`</span> <span class="sc">|&gt;</span> </span>
<span id="cb248-15"><a href="#cb248-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">FUN =</span> first) <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb248-16"><a href="#cb248-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb248-17"><a href="#cb248-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb248-18"><a href="#cb248-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>V3) <span class="sc">|&gt;</span> </span>
<span id="cb248-19"><a href="#cb248-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Lo95"</span>, <span class="st">"Hi95"</span>))</span>
<span id="cb248-20"><a href="#cb248-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-21"><a href="#cb248-21" aria-hidden="true" tabindex="-1"></a>forecast_data_full_sarima <span class="ot">&lt;-</span></span>
<span id="cb248-22"><a href="#cb248-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb248-23"><a href="#cb248-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">row.names</span>(<span class="fu">as.data.frame</span>(forecast.df)) <span class="sc">|&gt;</span></span>
<span id="cb248-24"><a href="#cb248-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ymd</span>(),</span>
<span id="cb248-25"><a href="#cb248-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">PointForecast =</span> CI_full<span class="sc">$</span>.mean,</span>
<span id="cb248-26"><a href="#cb248-26" aria-hidden="true" tabindex="-1"></a>    CI_full80,</span>
<span id="cb248-27"><a href="#cb248-27" aria-hidden="true" tabindex="-1"></a>    CI_full95</span>
<span id="cb248-28"><a href="#cb248-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The above gave the following results<br>
</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>forecast_plot_full_sarima <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(original_data2) <span class="sc">+</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> forecast_data_full_sarima, <span class="fu">aes</span>(date, <span class="at">ymin =</span> Lo95, <span class="at">ymax =</span> Hi95, <span class="at">fill =</span> <span class="st">"95% CI"</span>), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> forecast_data_full_sarima, <span class="fu">aes</span>(date, <span class="at">ymin =</span> Lo80, <span class="at">ymax =</span> Hi80, <span class="at">fill =</span> <span class="st">"80% CI"</span>), <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="at">data =</span> fitted_full, <span class="fu">aes</span>(date, <span class="at">y =</span> fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>)) <span class="sc">+</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="at">data =</span> forecast_data_full_sarima, <span class="fu">aes</span>(date, PointForecast, <span class="at">colour =</span> <span class="st">"Predicted human incidence"</span>)) <span class="sc">+</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_xspline</span>(<span class="fu">aes</span>(date, human_incidence, <span class="at">color =</span> <span class="st">"Actual human incidence"</span>)) <span class="sc">+</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb249-12"><a href="#cb249-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">hjust =</span> .<span class="dv">5</span>)</span>
<span id="cb249-13"><a href="#cb249-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb249-14"><a href="#cb249-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb249-15"><a href="#cb249-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Human Incidence"</span>) <span class="sc">+</span></span>
<span id="cb249-16"><a href="#cb249-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb249-17"><a href="#cb249-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb249-18"><a href="#cb249-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Predicted human incidence"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb249-19"><a href="#cb249-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Actual human incidence"</span> <span class="ot">=</span> <span class="st">"black"</span>,</span>
<span id="cb249-20"><a href="#cb249-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Fitted'</span> <span class="ot">=</span> <span class="st">'blue'</span></span>
<span id="cb249-21"><a href="#cb249-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb249-22"><a href="#cb249-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb249-23"><a href="#cb249-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb249-24"><a href="#cb249-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb249-25"><a href="#cb249-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"95% CI"</span> <span class="ot">=</span> <span class="st">"blue"</span>,</span>
<span id="cb249-26"><a href="#cb249-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"80% CI"</span> <span class="ot">=</span> <span class="st">"blue"</span></span>
<span id="cb249-27"><a href="#cb249-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb249-28"><a href="#cb249-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb249-29"><a href="#cb249-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">1</span>))</span>
<span id="cb249-30"><a href="#cb249-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb249-31"><a href="#cb249-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb249-32"><a href="#cb249-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>)</span>
<span id="cb249-33"><a href="#cb249-33" aria-hidden="true" tabindex="-1"></a>forecast_plot_full_sarima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brucellosis_updated_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model coefficients are;</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>full.model_coefficients <span class="ot">&lt;-</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(full.model) <span class="sc">|&gt;</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.model) <span class="sc">%&gt;%</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term)</span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(full.model_coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ar1</td>
<td style="text-align: right;">0.5276965</td>
<td style="text-align: right;">0.1940934</td>
<td style="text-align: right;">2.718776</td>
<td style="text-align: right;">0.0076791</td>
</tr>
<tr class="even">
<td style="text-align: left;">ma1</td>
<td style="text-align: right;">-0.7260114</td>
<td style="text-align: right;">0.1500707</td>
<td style="text-align: right;">-4.837797</td>
<td style="text-align: right;">0.0000046</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sar1</td>
<td style="text-align: right;">0.8624260</td>
<td style="text-align: right;">0.1309424</td>
<td style="text-align: right;">6.586301</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sma1</td>
<td style="text-align: right;">-0.7943738</td>
<td style="text-align: right;">0.1872603</td>
<td style="text-align: right;">-4.242083</td>
<td style="text-align: right;">0.0000482</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sma2</td>
<td style="text-align: right;">0.1592874</td>
<td style="text-align: right;">0.1259334</td>
<td style="text-align: right;">1.264854</td>
<td style="text-align: right;">0.2087505</td>
</tr>
<tr class="even">
<td style="text-align: left;">animal_incidence</td>
<td style="text-align: right;">0.0188223</td>
<td style="text-align: right;">0.0165687</td>
<td style="text-align: right;">1.136015</td>
<td style="text-align: right;">0.2585613</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The results of the forecasted values versus the actual, together with the upper 95% CI were as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasted and Actual data</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>fore.actual <span class="ot">&lt;-</span> forecast_data_full_sarima <span class="sc">|&gt;</span> </span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Actual =</span> <span class="fu">as.vector</span>(forecast.df<span class="sc">$</span>human_incidence),</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> <span class="fu">as.Date</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>           zoo<span class="sc">::</span><span class="fu">as.yearmon</span>() <span class="sc">|&gt;</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">yearmonth</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Date =</span> Date, </span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Forecasted =</span> PointForecast,</span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>         Actual,</span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Lower 95% CI</span><span class="st">`</span> <span class="ot">=</span> Lo95,</span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Upper 95% CI</span><span class="st">`</span> <span class="ot">=</span> Hi95,</span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">round</span>(., <span class="dv">3</span>)))) </span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(fore.actual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Date</th>
<th style="text-align: right;">Forecasted</th>
<th style="text-align: right;">Actual</th>
<th style="text-align: right;">Lower 95% CI</th>
<th style="text-align: right;">Upper 95% CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023 Jan</td>
<td style="text-align: right;">0.863</td>
<td style="text-align: right;">0.988</td>
<td style="text-align: right;">0.642</td>
<td style="text-align: right;">1.084</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023 Feb</td>
<td style="text-align: right;">0.890</td>
<td style="text-align: right;">0.905</td>
<td style="text-align: right;">0.607</td>
<td style="text-align: right;">1.174</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023 Mar</td>
<td style="text-align: right;">0.957</td>
<td style="text-align: right;">0.955</td>
<td style="text-align: right;">0.634</td>
<td style="text-align: right;">1.279</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023 Apr</td>
<td style="text-align: right;">0.854</td>
<td style="text-align: right;">0.818</td>
<td style="text-align: right;">0.502</td>
<td style="text-align: right;">1.207</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023 May</td>
<td style="text-align: right;">0.864</td>
<td style="text-align: right;">0.958</td>
<td style="text-align: right;">0.487</td>
<td style="text-align: right;">1.242</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023 Jun</td>
<td style="text-align: right;">0.905</td>
<td style="text-align: right;">1.041</td>
<td style="text-align: right;">0.505</td>
<td style="text-align: right;">1.305</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023 Jul</td>
<td style="text-align: right;">0.896</td>
<td style="text-align: right;">1.052</td>
<td style="text-align: right;">0.475</td>
<td style="text-align: right;">1.317</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023 Aug</td>
<td style="text-align: right;">0.872</td>
<td style="text-align: right;">0.977</td>
<td style="text-align: right;">0.432</td>
<td style="text-align: right;">1.312</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023 Sep</td>
<td style="text-align: right;">0.916</td>
<td style="text-align: right;">0.903</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">1.375</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023 Oct</td>
<td style="text-align: right;">0.926</td>
<td style="text-align: right;">0.969</td>
<td style="text-align: right;">0.449</td>
<td style="text-align: right;">1.402</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023 Nov</td>
<td style="text-align: right;">0.885</td>
<td style="text-align: right;">0.913</td>
<td style="text-align: right;">0.392</td>
<td style="text-align: right;">1.378</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023 Dec</td>
<td style="text-align: right;">0.800</td>
<td style="text-align: right;">0.821</td>
<td style="text-align: right;">0.291</td>
<td style="text-align: right;">1.310</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="supplementary-plots" class="level2">
<h2 class="anchored" data-anchor-id="supplementary-plots">Supplementary Plots</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supplementary plots --------------------------------------------------------------------</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>forecast_plot_covariate_sarima_title <span class="ot">&lt;-</span> forecast_plot_covariate_sarima <span class="sc">+</span></span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Forecast with exogenous variable"</span>)</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>null device 
          1 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"images/forecast_plot_covariate_sarima_title.png"</span>,</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">13</span>,</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">6</span>,</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="fl">1e3</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(patchwork)</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> forecast_plot_human_sarima<span class="sc">/</span>forecast_plot_covariate_sarima</span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>all</span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>null device 
          1 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"images/all_without_title_sarima.png"</span>,</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">13</span>,</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">10</span>,</span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="fl">1e3</span></span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>forecast_plot_human_sarima_title <span class="ot">&lt;-</span> forecast_plot_human_sarima <span class="sc">+</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Forecast without exogenous variable"</span>)</span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a>all_title <span class="ot">&lt;-</span> forecast_plot_human_sarima_title<span class="sc">/</span>forecast_plot_covariate_sarima_title</span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a>all_title</span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>null device 
          1 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"images/all_with_title_sarima.png"</span>,</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">13</span>,</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">10</span>,</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="fl">1e3</span></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>